<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vignesh Thiruvel Selvam">

<title>Why do teams buy from their rivals?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="rival_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="rival_analysis_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="rival_analysis_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="rival_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="rival_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rival_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="rival_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rival_analysis_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rival_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rival_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rival_analysis_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Why do teams buy from their rivals?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vignesh Thiruvel Selvam </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(worldfootballR)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'

The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year

The following objects are masked from 'package:dplyr':

    between, first, last

The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzyjoin)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="getting-league-data-for-each-season" class="level2">
<h2 class="anchored" data-anchor-id="getting-league-data-for-each-season">Getting League data for each season</h2>
<p>We get league table data for the top 5 leagues from 2017/18 season to 2024/2025 season.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>league_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(league_path)) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  leagues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"England"</span>, <span class="st">"Spain"</span>, <span class="st">"Germany"</span>, <span class="st">"Italy"</span>, <span class="st">"France"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  seasons <span class="ot">&lt;-</span> <span class="dv">2017</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  league_season_combos <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">league =</span> leagues, <span class="at">season =</span> seasons)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parallel fetching</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">future_pmap_dfr</span>(league_season_combos, <span class="cf">function</span>(league, season) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      matchday <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        league <span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">~</span> <span class="dv">34</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        league <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="dv">2019</span> <span class="sc">~</span> <span class="dv">27</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        league <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">&amp;</span> season <span class="sc">&gt;=</span> <span class="dv">2023</span> <span class="sc">~</span> <span class="dv">34</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">38</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fetching:"</span>, league, season))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">tm_matchday_table</span>(<span class="at">country_name=</span>league, <span class="at">start_year=</span>season, <span class="at">matchday=</span>matchday)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>season <span class="ot">&lt;-</span> season</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      df</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Error fetching"</span>, league, season, <span class="st">":"</span>, e<span class="sc">$</span>message))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fwrite</span>(df, league_path)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rivalry" class="level2">
<h2 class="anchored" data-anchor-id="rivalry">Rivalry</h2>
<p>We define rivalry based on two conditions:</p>
<ul>
<li><p>In the previous season, teams that finished two places above or below a specific team are said to be its rivals.</p></li>
<li><p>Teams that have an ELO of 100 points more or less than the specific team are said to be its rivals.</p></li>
<li><p>Rivalry is considered only for teams that belong to the same league.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) read</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dt_raw <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>dt_raw[, team <span class="sc">:</span><span class="er">=</span> <span class="fu">str_squish</span>(squad)]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>dt_raw[, season <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(season)]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>dt_raw[, league <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(league)]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>dt_raw[, pos <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(rk)]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"matchday"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dt_raw)) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  dt_final <span class="ot">&lt;-</span> dt_raw[<span class="sc">!</span><span class="fu">is.na</span>(pos), .SD[<span class="fu">which.max</span>(<span class="fu">as.numeric</span>(matchday))], </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                     by <span class="ot">=</span> .(country, league, season, team)]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  dt_final <span class="ot">&lt;-</span> dt_raw[<span class="sc">!</span><span class="fu">is.na</span>(pos), .SD[<span class="dv">1</span>], by <span class="ot">=</span> .(country, league, season, team)]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only needed cols</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>dt_final <span class="ot">&lt;-</span> dt_final[, .(country, league, season, team, pos)]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>dt_final[, team_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(team)]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>dt_final[, country_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(country)]</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>dt_final[, league_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(league)]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Build interval table (y) and point table (x) with distinct column names ---</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># y: intervals owned by a team (pos_low .. pos_high)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>dt_y <span class="ot">&lt;-</span> dt_final[, .(country, league, season,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos_low =</span> pos <span class="sc">-</span> <span class="dv">2</span>L,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos_high =</span> pos <span class="sc">+</span> <span class="dv">2</span>L,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">team_y =</span> team,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos_y =</span> pos)]</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># x: points to be matched into intervals</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>dt_x <span class="ot">&lt;-</span> dt_final[, .(country, league, season,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos_x =</span> pos,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">team_x =</span> team,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos_orig =</span> pos)]</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create start/end for pts (required by foverlaps)</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>dt_x[, pos_x_start <span class="sc">:</span><span class="er">=</span> pos_x][, pos_x_end <span class="sc">:</span><span class="er">=</span> pos_x]</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Set keys including country/league/season then interval start/end</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt_y, country, league, season, pos_low, pos_high)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt_x, country, league, season, pos_x_start, pos_x_end)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4) Overlap join: match points to intervals within same country/league/season ---</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>ov <span class="ot">&lt;-</span> <span class="fu">foverlaps</span>(<span class="at">x =</span> dt_x, <span class="at">y =</span> dt_y,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"league"</span>, <span class="st">"season"</span>, <span class="st">"pos_x_start"</span>, <span class="st">"pos_x_end"</span>),</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"league"</span>, <span class="st">"season"</span>, <span class="st">"pos_low"</span>, <span class="st">"pos_high"</span>),</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">nomatch =</span> <span class="dv">0</span>L)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5) Select relevant columns, remove self-matches, deduplicate unordered pairs ---</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ov contains columns from x and y; pick team_x (point) and team_y (interval owner)</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>rivals <span class="ot">&lt;-</span> ov[, .(<span class="at">country =</span> country, <span class="at">league =</span> league, <span class="at">season =</span> season,</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">team1 =</span> team_x, <span class="at">pos1 =</span> pos_x,</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">team2 =</span> team_y, <span class="at">pos2 =</span> pos_y)]</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co"># remove identical teams and keep unordered unique pair per (country,league,season)</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>rivals <span class="ot">&lt;-</span> rivals[team1 <span class="sc">!=</span> team2]</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>rivals[, team_a <span class="sc">:</span><span class="er">=</span> <span class="fu">pmin</span>(team1, team2)]</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>rivals[, team_b <span class="sc">:</span><span class="er">=</span> <span class="fu">pmax</span>(team1, team2)]</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>rivals[, pos_diff <span class="sc">:</span><span class="er">=</span> <span class="fu">abs</span>(<span class="fu">as.integer</span>(pos1) <span class="sc">-</span> <span class="fu">as.integer</span>(pos2))]</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>rivals <span class="ot">&lt;-</span> <span class="fu">unique</span>(rivals[, .(country, league, season, team_a, team_b, pos_diff)])</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(rivals, country, league, season, team_a, team_b)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6) Add lowercase keys and set key for fast lookup ---</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>rivals[, team_a_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(team_a)]</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>rivals[, team_b_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(team_b)]</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>rivals[, country_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(country)]</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>rivals[, league_low <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(league)]</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(rivals, country_low, league_low, season, team_a_low, team_b_low)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 7) Helper lookup --</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage: is_rival("England", "Premier League", "Arsenal", "Chelsea", "2020/2021")</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>is_rival <span class="ot">&lt;-</span> <span class="cf">function</span>(country_in, league_in, t1, t2, season_in) {</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(country_in))</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  ll <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(league_in))</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(t1)); b <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(t2))</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(a <span class="sc">&lt;</span> b, a, b); b1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(a <span class="sc">&lt;</span> b, b, a)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> rivals[<span class="fu">J</span>(cl, ll, season_in, a1, b1), nomatch <span class="ot">=</span> <span class="dv">0</span>L]</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(res) <span class="sc">&gt;</span> <span class="dv">0</span>L</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Save output</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(rivals, <span class="st">"~/sem3/research_project/rival_analysis/data/season_rivalries.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rivals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country_low, league_low, season, team_a_low, team_b_low&gt;
      country                                    league season          team_a
       &lt;char&gt;                                    &lt;char&gt; &lt;char&gt;          &lt;char&gt;
   1: England Games of Matchday 38 Premier League 17/18   2017         Arsenal
   2: England Games of Matchday 38 Premier League 17/18   2017         Arsenal
   3: England Games of Matchday 38 Premier League 17/18   2017         Arsenal
   4: England Games of Matchday 38 Premier League 17/18   2017         Arsenal
   5: England Games of Matchday 38 Premier League 17/18   2017     Bournemouth
  ---                                                                         
1436:   Spain         Games of Matchday 38 LaLiga 24/25   2024    RCD Mallorca
1437:   Spain         Games of Matchday 38 LaLiga 24/25   2024      Real Betis
1438:   Spain         Games of Matchday 38 LaLiga 24/25   2024   Real Sociedad
1439:   Spain         Games of Matchday 38 LaLiga 24/25   2024 Real Valladolid
1440:   Spain         Games of Matchday 38 LaLiga 24/25   2024      Sevilla FC
              team_b pos_diff      team_a_low     team_b_low country_low
              &lt;char&gt;    &lt;int&gt;          &lt;char&gt;         &lt;char&gt;      &lt;char&gt;
   1:        Burnley        1         arsenal        burnley     england
   2:        Chelsea        1         arsenal        chelsea     england
   3:        Everton        2         arsenal        everton     england
   4:      Liverpool        2         arsenal      liverpool     england
   5: Crystal Palace        1     bournemouth crystal palace     england
  ---                                                                   
1436:       Valencia        2    rcd mallorca       valencia       spain
1437:     Villarreal        1      real betis     villarreal       spain
1438:       Valencia        1   real sociedad       valencia       spain
1439:  UD Las Palmas        1 real valladolid  ud las palmas       spain
1440:  UD Las Palmas        2      sevilla fc  ud las palmas       spain
                                     league_low
                                         &lt;char&gt;
   1: games of matchday 38 premier league 17/18
   2: games of matchday 38 premier league 17/18
   3: games of matchday 38 premier league 17/18
   4: games of matchday 38 premier league 17/18
   5: games of matchday 38 premier league 17/18
  ---                                          
1436:         games of matchday 38 laliga 24/25
1437:         games of matchday 38 laliga 24/25
1438:         games of matchday 38 laliga 24/25
1439:         games of matchday 38 laliga 24/25
1440:         games of matchday 38 laliga 24/25</code></pre>
</div>
</div>
<section id="elo" class="level3">
<h3 class="anchored" data-anchor-id="elo">ELO</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- PARAMETERS ----------------</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>snapshot_month_day <span class="ot">&lt;-</span> <span class="st">"-09-01"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>elo_thresh <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>max_name_dist <span class="ot">&lt;-</span> <span class="fl">0.18</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- PATHS (uses uploaded files in ~/sem3/research_project/rival_analysis/data) ----------------</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>league_csv <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>manual_map_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/manual_club_map.csv"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>out_rivals_csv <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out_dir, <span class="st">"season_rivalries_elo_combined.csv"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>out_elo_raw_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out_dir, <span class="st">"elo_snapshots"</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(out_elo_raw_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 1) load &amp; prepare league table (dt_final) ----------------</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>dt_raw <span class="ot">&lt;-</span> <span class="fu">fread</span>(league_csv)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>dt_raw[, team <span class="sc">:</span><span class="er">=</span> <span class="fu">str_squish</span>(squad)]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>dt_raw[, country <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(country)]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>dt_raw[, league <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(league)]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>dt_raw[, season <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(season)]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>dt_raw[, pos <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(rk)]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"matchday"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dt_raw)) {</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  dt_final <span class="ot">&lt;-</span> dt_raw[<span class="sc">!</span><span class="fu">is.na</span>(pos), .SD[<span class="fu">which.max</span>(<span class="fu">as.numeric</span>(matchday))], by <span class="ot">=</span> .(country, league, season, team)]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  dt_final <span class="ot">&lt;-</span> dt_raw[<span class="sc">!</span><span class="fu">is.na</span>(pos), .SD[<span class="dv">1</span>], by <span class="ot">=</span> .(country, league, season, team)]</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>dt_final <span class="ot">&lt;-</span> dt_final[, .(country, league, season, team, pos)]</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>dt_final[, team_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team))]</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Precompute season_start string on dt_final for lookups (e.g., "2017" from "2017/18")</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>dt_final[, season_start_str <span class="sc">:</span><span class="er">=</span> <span class="fu">sub</span>(<span class="st">"([0-9]{4}).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, season)]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 2) fetch ClubElo snapshots (cached) ----------------</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>fetch_elo_for_date <span class="ot">&lt;-</span> <span class="cf">function</span>(date_str) {</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  destfile <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out_elo_raw_dir, <span class="fu">paste0</span>(<span class="st">"clubelo_"</span>, date_str, <span class="st">".csv"</span>))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(destfile)) {</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Using cached Elo snapshot: "</span>, destfile)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(destfile, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>(df); <span class="fu">return</span>(df)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"http://api.clubelo.com/"</span>, date_str)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Fetching from API: "</span>, url)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(url)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">status_code</span>(r) <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">stop</span>(<span class="st">"ClubElo request failed for date "</span>, date_str, <span class="st">" (status "</span>, httr<span class="sc">::</span><span class="fu">status_code</span>(r), <span class="st">")"</span>)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(r, <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(txt, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setDT</span>(df)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(df, <span class="fu">tolower</span>(<span class="fu">names</span>(df)))</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  club_col <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"club|team|name"</span>, <span class="fu">names</span>(df), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  elo_col  <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"elo|rating"</span>, <span class="fu">names</span>(df), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(club_col) <span class="sc">||</span> <span class="fu">is.na</span>(elo_col)) <span class="fu">stop</span>(<span class="st">"Unable to find club/elo columns in ClubElo CSV for date: "</span>, date_str)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, .(<span class="at">club =</span> <span class="fu">get</span>(club_col), <span class="at">elo =</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(elo_col)))]</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="sc">!</span><span class="fu">is.na</span>(elo) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(club)]</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  df[, club_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.*</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, club)))]</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="fu">order</span>(<span class="sc">-</span>elo)]</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  df[, snapshot_date <span class="sc">:</span><span class="er">=</span> date_str]</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(df, destfile)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Saved snapshot: "</span>, destfile)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch and cache all snapshots (only does network calls if missing)</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>elo_all <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(seasons, <span class="cf">function</span>(y) {</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">paste0</span>(y, snapshot_month_day)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Fetch snapshot: "</span>, d)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>) <span class="co"># be kind to API</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fetch_elo_for_date</span>(d)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>}), <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2018-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2018-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2019-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2019-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2020-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2020-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2021-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2021-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2022-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2022-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2023-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2023-09-01.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetch snapshot: 2024-09-01</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using cached Elo snapshot: ~/sem3/research_project/rival_analysis/data/elo_snapshots/clubelo_2024-09-01.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Total Elo rows fetched (or cached): "</span>, <span class="fu">nrow</span>(elo_all))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Total Elo rows fetched (or cached): 4455</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>elo_all[, season_start <span class="sc">:</span><span class="er">=</span> <span class="fu">substr</span>(snapshot_date, <span class="dv">1</span>, <span class="dv">4</span>)]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 3) APPLY MANUAL MAPPINGS (rowwise, robust) ----------------</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>manual_map_applied <span class="ot">&lt;-</span> <span class="fu">data.table</span>()  <span class="co"># result holder</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(manual_map_path)) {</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">fread</span>(manual_map_path)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize columns: support snapshot_date or season_start</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"snapshot_date"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mm)) <span class="sc">&amp;</span> (<span class="st">"season_start"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mm))) {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    mm[, snapshot_date <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(season_start, snapshot_month_day)]</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"club"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mm)) <span class="sc">|</span> <span class="sc">!</span>(<span class="st">"mapped_team"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mm))) {</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"manual_club_map.csv must contain at minimum: club, mapped_team, and snapshot_date or season_start"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  mm[, club_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.*</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, club)))]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  mm[, mapped_team_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(mapped_team))]</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  mm[, season_start <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(<span class="fu">substring</span>(snapshot_date, <span class="dv">1</span>, <span class="dv">4</span>))]</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rowwise validate and build manual_map_applied</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  valid_rows <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(mm))) {</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> mm[i]</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> <span class="fu">as.character</span>(row<span class="sc">$</span>season_start)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    mt_clean <span class="ot">&lt;-</span> row<span class="sc">$</span>mapped_team_clean</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check dt_final: does mapped team exist in that season_start?</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    cand <span class="ot">&lt;-</span> dt_final[team_clean <span class="sc">==</span> mt_clean <span class="sc">&amp;</span> season_start_str <span class="sc">==</span> ss]</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(cand) <span class="sc">==</span> <span class="dv">0</span>L) <span class="cf">next</span>  <span class="co"># invalid mapping: mapped_team not present in league for that season</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find matching elo rows for the same snapshot + club_clean</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    erows <span class="ot">&lt;-</span> elo_all[season_start <span class="sc">==</span> ss <span class="sc">&amp;</span> club_clean <span class="sc">==</span> row<span class="sc">$</span>club_clean]</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(erows) <span class="sc">==</span> <span class="dv">0</span>L) <span class="cf">next</span>  <span class="co"># no matching elo row to attach</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build manual match rows</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (er <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(erows))) {</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (cd <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(cand))) {</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        valid_rows[[<span class="fu">length</span>(valid_rows) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">snapshot_date =</span> erows[er, snapshot_date],</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">club =</span> erows[er, club],</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">club_clean =</span> erows[er, club_clean],</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">elo =</span> erows[er, elo],</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">team =</span> cand[cd, team],</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">team_clean =</span> cand[cd, team_clean],</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">country =</span> cand[cd, country],</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">league =</span> cand[cd, league],</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">dist =</span> <span class="dv">0</span>  <span class="co"># mark manual mapping as exact</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(valid_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    manual_map_applied <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(valid_rows, <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Applied "</span>, <span class="fu">nrow</span>(manual_map_applied), <span class="st">" manual mapping rows from: "</span>, manual_map_path)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No valid manual mappings found in: "</span>, manual_map_path)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No manual_club_map.csv found at: "</span>, manual_map_path, <span class="st">" (continuing without manual mappings)"</span>)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Applied 100 manual mapping rows from: ~/sem3/research_project/rival_analysis/data/manual_club_map.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 4) FUZZY MATCH remaining Elo clubs -&gt; dt_final teams ----------------</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Build candidate list excluding manual-mapped (by snapshot_date+club_clean)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>elo_to_match <span class="ot">&lt;-</span> <span class="fu">copy</span>(elo_all[, .(snapshot_date, club, club_clean, elo, season_start)])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(manual_map_applied) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  keys_mm <span class="ot">&lt;-</span> <span class="fu">unique</span>(manual_map_applied[, .(snapshot_date, club_clean)])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setkey</span>(elo_to_match, snapshot_date, club_clean)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setkey</span>(keys_mm, snapshot_date, club_clean)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Proper anti-join (no need for fsetdiff)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  elo_to_match <span class="ot">&lt;-</span> elo_to_match[<span class="sc">!</span>keys_mm]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Build teams by season_start</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>teams_by_start <span class="ot">&lt;-</span> <span class="fu">unique</span>(dt_final[, .(season_start_str, team, team_clean, country, league)])</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(teams_by_start, <span class="st">"season_start_str"</span>, <span class="st">"season_start"</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>matched_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>unmatched_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yr <span class="cf">in</span> <span class="fu">sort</span>(<span class="fu">unique</span>(elo_to_match<span class="sc">$</span>season_start))) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  eloy <span class="ot">&lt;-</span> elo_to_match[season_start <span class="sc">==</span> yr, .(snapshot_date, club, club_clean, elo)]</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  targ <span class="ot">&lt;-</span> teams_by_start[season_start <span class="sc">==</span> yr, .(team, team_clean, country, league)]</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(targ) <span class="sc">==</span> <span class="dv">0</span>L) { unmatched_list[[yr]] <span class="ot">&lt;-</span> eloy; <span class="cf">next</span> }</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  mj <span class="ot">&lt;-</span> <span class="fu">stringdist_inner_join</span>(eloy, targ, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"club_clean"</span> <span class="ot">=</span> <span class="st">"team_clean"</span>),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"jw"</span>, <span class="at">max_dist =</span> max_name_dist, <span class="at">distance_col =</span> <span class="st">"dist"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setDT</span>(mj); <span class="fu">setorder</span>(mj, snapshot_date, club, dist)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(mj) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    mj <span class="ot">&lt;-</span> mj[, .SD[<span class="dv">1</span>], by <span class="ot">=</span> .(snapshot_date, club)]  <span class="co"># best match per elo club</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    matched_list[[yr]] <span class="ot">&lt;-</span> mj</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    matched_clubs <span class="ot">&lt;-</span> <span class="fu">unique</span>(mj<span class="sc">$</span>club)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    unmatched_list[[yr]] <span class="ot">&lt;-</span> eloy[<span class="sc">!</span>club <span class="sc">%in%</span> matched_clubs]</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    unmatched_list[[yr]] <span class="ot">&lt;-</span> eloy</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>matched_dt_fuzzy <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(matched_list) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">rbindlist</span>(matched_list, <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">data.table</span>()</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>unmatched_dt <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(unmatched_list) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">rbindlist</span>(unmatched_list, <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">data.table</span>()</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine manual-applied matches and fuzzy matches into matched_dt</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(manual_map_applied) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(matched_dt_fuzzy) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>  matched_dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(manual_map_applied, matched_dt_fuzzy[, .(snapshot_date, club, club_clean, elo, team, team_clean, country, league, dist)]),</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>                          <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">nrow</span>(manual_map_applied) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>  matched_dt <span class="ot">&lt;-</span> <span class="fu">copy</span>(manual_map_applied)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>  matched_dt <span class="ot">&lt;-</span> <span class="fu">copy</span>(matched_dt_fuzzy)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Save remaining unmatched for inspection</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(unmatched_dt) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fwrite</span>(<span class="fu">unique</span>(unmatched_dt), <span class="fu">file.path</span>(out_dir, <span class="st">"elo_unmatched_clubs_remaining.csv"</span>))</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Wrote remaining unmatched Elo clubs to: "</span>, <span class="fu">file.path</span>(out_dir, <span class="st">"elo_unmatched_clubs_remaining.csv"</span>))</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># produce empty file to indicate nothing remaining</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fwrite</span>(<span class="fu">data.table</span>(<span class="at">snapshot_date=</span><span class="fu">character</span>(), <span class="at">club=</span><span class="fu">character</span>(), <span class="at">club_clean=</span><span class="fu">character</span>(), <span class="at">elo=</span><span class="fu">numeric</span>()),</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>         <span class="fu">file.path</span>(out_dir, <span class="st">"elo_unmatched_clubs_remaining.csv"</span>))</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No remaining unmatched Elo clubs; created empty file: "</span>, <span class="fu">file.path</span>(out_dir, <span class="st">"elo_unmatched_clubs_remaining.csv"</span>))</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Wrote remaining unmatched Elo clubs to: ~/sem3/research_project/rival_analysis/data/elo_unmatched_clubs_remaining.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 5) set Elo-season = snapshot_year - 1 (numeric) for Elo outputs ONLY ----------------</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(matched_dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Warning: matched_dt is empty (no Elo-&gt;league matches). Elo-only will be empty."</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>matched_dt[, snapshot_year <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(snapshot_date, <span class="dv">1</span>, <span class="dv">4</span>))]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>matched_dt[, elo_season <span class="sc">:</span><span class="er">=</span> snapshot_year <span class="sc">-</span> <span class="dv">1</span>L]  <span class="co"># e.g., 2018 -&gt; 2017</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 6) build Elo-based rivals (use league internally) ----------------</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(matched_dt)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(matched_dt, country, league, elo_season)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>pairs_elo <span class="ot">&lt;-</span> matched_dt[matched_dt, on <span class="ot">=</span> .(country, league, elo_season), allow.cartesian <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># defensive renaming for join-produced columns</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(pairs_elo,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">old =</span> <span class="fu">c</span>(<span class="st">"club"</span>,<span class="st">"elo"</span>,<span class="st">"team"</span>,<span class="st">"dist"</span>,<span class="st">"i.club"</span>,<span class="st">"i.elo"</span>,<span class="st">"i.team"</span>,<span class="st">"i.dist"</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"club1"</span>,<span class="st">"elo1"</span>,<span class="st">"team1"</span>,<span class="st">"dist1"</span>,<span class="st">"club2"</span>,<span class="st">"elo2"</span>,<span class="st">"team2"</span>,<span class="st">"dist2"</span>),</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>pairs_elo <span class="ot">&lt;-</span> pairs_elo[team1 <span class="sc">!=</span> team2]</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>pairs_elo[, elo_diff <span class="sc">:</span><span class="er">=</span> <span class="fu">abs</span>(<span class="fu">as.numeric</span>(elo1) <span class="sc">-</span> <span class="fu">as.numeric</span>(elo2))]</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>elo_rivals_full <span class="ot">&lt;-</span> pairs_elo[elo_diff <span class="sc">&lt;=</span> elo_thresh,</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>                             .(country, league, <span class="at">season =</span> elo_season,</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">team_a =</span> <span class="fu">pmin</span>(team1, team2),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                               <span class="at">team_b =</span> <span class="fu">pmax</span>(team1, team2),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                               elo_diff)]</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>elo_rivals_full <span class="ot">&lt;-</span> <span class="fu">unique</span>(elo_rivals_full)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(elo_rivals_full, country, league, season, team_a, team_b)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Elo-only WITHOUT league column, with season numeric = snapshot_year - 1</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>elo_rivals_save <span class="ot">&lt;-</span> elo_rivals_full[, .(country, season, team_a, team_b, elo_diff)]</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(elo_rivals_save, <span class="fu">file.path</span>(out_dir, <span class="st">"season_rivalries_elo_only.csv"</span>))</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Saved Elo-only rivals (no league column) to: "</span>, <span class="fu">file.path</span>(out_dir, <span class="st">"season_rivalries_elo_only.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved Elo-only rivals (no league column) to: ~/sem3/research_project/rival_analysis/data/season_rivalries_elo_only.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 7) build positional rivals (pos diff &lt;=2) using dt_final-derived season numeric ----------------</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpret pos-season numeric as the starting year (YYYY) from dt_final$season</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>dt_final[, season_start_num <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(<span class="fu">sub</span>(<span class="st">"([0-9]{4}).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, season))]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>dt_final[, pos_season <span class="sc">:</span><span class="er">=</span> season_start_num <span class="sc">-</span> <span class="dv">0</span>L]  <span class="co"># pos_season numeric = starting year (e.g., 2017 for "2017/18")</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>pos_dt <span class="ot">&lt;-</span> dt_final[, .(country, league, <span class="at">season =</span> pos_season, team, pos)]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> pos_dt[pos_dt, on <span class="ot">=</span> .(country, league, season), allow.cartesian <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(pr, <span class="fu">c</span>(<span class="st">"team"</span>,<span class="st">"i.team"</span>,<span class="st">"pos"</span>,<span class="st">"i.pos"</span>), <span class="fu">c</span>(<span class="st">"team1"</span>,<span class="st">"team2"</span>,<span class="st">"pos1"</span>,<span class="st">"pos2"</span>), <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> pr[team1 <span class="sc">!=</span> team2]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>pr[, pos_diff <span class="sc">:</span><span class="er">=</span> <span class="fu">abs</span>(<span class="fu">as.integer</span>(pos1) <span class="sc">-</span> <span class="fu">as.integer</span>(pos2))]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>pos_rivals_pairs <span class="ot">&lt;-</span> pr[pos_diff <span class="sc">&lt;=</span> <span class="dv">2</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>                       .(country, league, season, <span class="at">team_a =</span> <span class="fu">pmin</span>(team1, team2), <span class="at">team_b =</span> <span class="fu">pmax</span>(team1, team2), pos_diff)]</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>pos_rivals_pairs <span class="ot">&lt;-</span> <span class="fu">unique</span>(pos_rivals_pairs)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(pos_rivals_pairs, <span class="fu">file.path</span>(out_dir, <span class="st">"season_rivalries_pos_only.csv"</span>))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Saved positional-only rivals to: "</span>, <span class="fu">file.path</span>(out_dir, <span class="st">"season_rivalries_pos_only.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved positional-only rivals to: ~/sem3/research_project/rival_analysis/data/season_rivalries_pos_only.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 8) combine pos &amp; elo rivals into final combined file (aligned numeric seasons) ----------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">merge</span>(pos_rivals_pairs, elo_rivals_full,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"league"</span>, <span class="st">"season"</span>, <span class="st">"team_a"</span>, <span class="st">"team_b"</span>), <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>full[<span class="fu">is.na</span>(pos_diff), pos_diff <span class="sc">:</span><span class="er">=</span> <span class="dv">999</span>L]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>full[<span class="fu">is.na</span>(elo_diff), elo_diff <span class="sc">:</span><span class="er">=</span> <span class="dv">999</span>L]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>full[, is_rival <span class="sc">:</span><span class="er">=</span> (pos_diff <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">|</span> (elo_diff <span class="sc">&lt;=</span> elo_thresh)]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(full, country, league, season, team_a, team_b)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(full, out_rivals_csv)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Saved combined rival list to: "</span>, out_rivals_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved combined rival list to: ~/sem3/research_project/rival_analysis/data/season_rivalries_elo_combined.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- 9) diagnostics / dumps ----------------</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># write complete snapshot summary and manual-map info for auditing</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(<span class="fu">unique</span>(elo_all[, .(snapshot_date, club, club_clean, elo)]), <span class="fu">file.path</span>(out_dir, <span class="st">"elo_all_snapshot_summary.csv"</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(manual_map_path)) {</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">fread</span>(manual_map_path)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fwrite</span>(mm, <span class="fu">file.path</span>(out_dir, <span class="st">"manual_club_map_used.csv"</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># remaining unmatched already saved above</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Pipeline complete. Inspect files in "</span>, out_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Pipeline complete. Inspect files in ~/sem3/research_project/rival_analysis/data</code></pre>
</div>
</div>
</section>
</section>
<section id="transfers" class="level2">
<h2 class="anchored" data-anchor-id="transfers">Transfers</h2>
<p>We now get the transfer data for all teams in the top 5 leagues from 2018 to 2024 transfer windows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect summer transfers (2018/19 .. 2024/25) using only country + season_start.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses existing column `squad` in ~/sem3/research_project/rival_analysis/data/league_table.csv (no new "team" column created).</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- PARAMETERS &amp; PATHS ----------</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>league_csv <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span>   <span class="co"># your uploaded file (use existing 'squad' col)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data"</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>cache_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out_dir, <span class="st">"transfers_cache"</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(cache_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>season_starts <span class="ot">&lt;-</span> <span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span>      <span class="co"># represent seasons 2018/19 .. 2024/25</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>sleep_sec <span class="ot">&lt;-</span> <span class="dv">3</span>                  <span class="co"># polite pause between requests</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>max_retries <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>retry_sleep <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>out_csv <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out_dir, <span class="st">"transfers_summer_2018_2025.csv"</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- HELPERS ----------</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>safe_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">"[^A-Za-z0-9_</span><span class="sc">\\</span><span class="st">-]"</span>, <span class="st">"_"</span>, <span class="fu">substr</span>(x, <span class="dv">1</span>, <span class="dv">120</span>))</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>league_urls_cache_file <span class="ot">&lt;-</span> <span class="cf">function</span>(country_name, start_year) {</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(cache_dir, <span class="fu">paste0</span>(<span class="st">"league_urls_"</span>, <span class="fu">safe_fn</span>(country_name), <span class="st">"_"</span>, start_year, <span class="st">".rds"</span>))</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>team_transfers_cache_file <span class="ot">&lt;-</span> <span class="cf">function</span>(team_url, season_start) {</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.path</span>(cache_dir, <span class="fu">paste0</span>(<span class="st">"team_transfers_"</span>, <span class="fu">safe_fn</span>(team_url), <span class="st">"_"</span>, season_start, <span class="st">".rds"</span>))</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co"># cached call for league -&gt; team urls</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>get_league_team_urls_cached <span class="ot">&lt;-</span> <span class="cf">function</span>(country_name, start_year) {</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  cachef <span class="ot">&lt;-</span> <span class="fu">league_urls_cache_file</span>(country_name, start_year)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(cachef)) <span class="fu">return</span>(<span class="fu">readRDS</span>(cachef))</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(max_retries)) {</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>({</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>      urls <span class="ot">&lt;-</span> <span class="fu">tm_league_team_urls</span>(<span class="at">country_name =</span> country_name, <span class="at">start_year =</span> start_year)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(urls, cachef)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.sleep</span>(sleep_sec)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(urls)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Retrying league-team-urls for "</span>, country_name, <span class="st">" "</span>, start_year, <span class="st">" (attempt "</span>, i, <span class="st">")"</span>)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(retry_sleep)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"Failed to fetch league team URLs for "</span>, country_name, <span class="st">" "</span>, start_year)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="co"># cached call for team -&gt; transfers (summer)</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>get_team_transfers_cached <span class="ot">&lt;-</span> <span class="cf">function</span>(team_url, season_start) {</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  cachef <span class="ot">&lt;-</span> <span class="fu">team_transfers_cache_file</span>(team_url, season_start)</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(cachef)) <span class="fu">return</span>(<span class="fu">readRDS</span>(cachef))</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(max_retries)) {</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>({</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>      xf <span class="ot">&lt;-</span> <span class="fu">tm_team_transfers</span>(<span class="at">team_url =</span> team_url, <span class="at">transfer_window =</span> <span class="st">"summer"</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(xf, cachef)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.sleep</span>(sleep_sec)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(xf)</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Retrying team transfers for "</span>, team_url, <span class="st">" (attempt "</span>, i, <span class="st">")"</span>)</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(retry_sleep)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No transfers found for team: "</span>, team_url)</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="co"># cheap fuzzy compare to decide whether a returned team name matches a squad in your league table</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>close_name_match <span class="ot">&lt;-</span> <span class="cf">function</span>(x, candidates, <span class="at">max_dist =</span> <span class="fl">0.18</span>) {</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x: single string, candidates: vector of strings</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(x) <span class="sc">||</span> x <span class="sc">==</span> <span class="st">""</span>) <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use jaro-winkler via stringdist if available; fallback to grepl substring match</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"stringdist"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> stringdist<span class="sc">::</span><span class="fu">stringdist</span>(<span class="fu">tolower</span>(<span class="fu">str_squish</span>(x)), <span class="fu">tolower</span>(<span class="fu">str_squish</span>(candidates)), <span class="at">method =</span> <span class="st">"jw"</span>)</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">any</span>(d <span class="sc">&lt;=</span> max_dist)</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">any</span>(<span class="fu">grepl</span>(<span class="fu">tolower</span>(<span class="fu">str_squish</span>(x)), <span class="fu">tolower</span>(candidates), <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- 1) Read league table and derive country+season_start combos ----------</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(league_csv)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a><span class="co"># use existing 'squad' column (do not create new 'team' column)</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"squad"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dt)) <span class="fu">stop</span>(<span class="st">"'squad' column not found in league_table.csv"</span>)</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>dt[, squad_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(squad))]</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>dt[, season_start <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(<span class="fu">sub</span>(<span class="st">"([0-9]{4}).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, season))]   <span class="co"># extracts starting year like 2018 from "2018/19"</span></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt[season_start <span class="sc">%in%</span> season_starts]</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>country_seasons <span class="ot">&lt;-</span> <span class="fu">unique</span>(dt[, .(country, season_start)])</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(country_seasons, country, season_start)</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Build quick lookup of squads per country+season for filtering</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>squads_by_country_season <span class="ot">&lt;-</span> dt[, .(<span class="at">squad_list =</span> <span class="fu">list</span>(<span class="fu">unique</span>(squad_clean))), by <span class="ot">=</span> .(country, season_start)]</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(squads_by_country_season, country, season_start)</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- 2) iterate country+season, fetch team URLs, then fetch summer transfers ----------</span></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>all_transfers <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(country_seasons))) {</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>  cs <span class="ot">&lt;-</span> country_seasons[r]</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>  cntry <span class="ot">&lt;-</span> cs<span class="sc">$</span>country</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>  sstart <span class="ot">&lt;-</span> cs<span class="sc">$</span>season_start</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Processing: "</span>, cntry, <span class="st">" | season_start "</span>, sstart)</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>  urls_tbl <span class="ot">&lt;-</span> <span class="fu">get_league_team_urls_cached</span>(cntry, sstart)</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(urls_tbl) <span class="sc">||</span> <span class="fu">length</span>(urls_tbl) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">" No team URLs returned for country "</span>, cntry, <span class="st">" season "</span>, sstart, <span class="st">" — skipping"</span>)</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize returned structure to a data.table with at least a team_url column and optionally a display name</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(urls_tbl)) {</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>    team_urls_df <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">data.table</span>(<span class="at">team_url =</span> urls_tbl))</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.data.frame</span>(urls_tbl) <span class="sc">||</span> <span class="fu">is.data.table</span>(urls_tbl)) {</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try to detect url column and name column</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    url_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(urls_tbl), <span class="fu">c</span>(<span class="st">"team_url"</span>, <span class="st">"url"</span>, <span class="st">"link"</span>, <span class="st">"teamlink"</span>, <span class="st">"team_url_href"</span>))[<span class="dv">1</span>]</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>    name_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(urls_tbl), <span class="fu">c</span>(<span class="st">"team"</span>, <span class="st">"club"</span>, <span class="st">"club_name"</span>, <span class="st">"team_name"</span>, <span class="st">"name"</span>))[<span class="dv">1</span>]</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(url_col)) {</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>      team_urls_df <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">data.table</span>(<span class="at">team_url =</span> <span class="fu">as.character</span>(urls_tbl[[url_col]])))</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(name_col)) team_urls_df[, team_name <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(urls_tbl[[name_col]])]</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fallback: use first column as url</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>      team_urls_df <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">data.table</span>(<span class="at">team_url =</span> <span class="fu">as.character</span>(urls_tbl[[<span class="dv">1</span>]])))</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">" Unrecognized return type from tm_league_team_urls() — skipping this country-season."</span>)</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OPTIONAL: filter returned URLs to squads that exist in your league_table for that country+season</span></span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This avoids scraping unrelated clubs. Keep enabled by default.</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>  filter_local <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (filter_local <span class="sc">&amp;&amp;</span> <span class="st">"team_name"</span> <span class="sc">%in%</span> <span class="fu">names</span>(team_urls_df)) {</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>    squads_local <span class="ot">&lt;-</span> squads_by_country_season[<span class="fu">J</span>(cntry, sstart), squad_list][[<span class="dv">1</span>]]</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep only urls whose team_name roughly matches any squad</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>    keep_mask <span class="ot">&lt;-</span> <span class="fu">sapply</span>(team_urls_df<span class="sc">$</span>team_name, <span class="cf">function</span>(nm) <span class="fu">close_name_match</span>(nm, squads_local))</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="sc">!</span>keep_mask)) {</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>      <span class="co"># if filter removed all, fall back to not filtering (safer)</span></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"  Local filtering removed all returned team URLs — falling back to unfiltered list"</span>)</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>      team_urls_final <span class="ot">&lt;-</span> <span class="fu">unique</span>(team_urls_df<span class="sc">$</span>team_url)</span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>      team_urls_final <span class="ot">&lt;-</span> <span class="fu">unique</span>(team_urls_df<span class="sc">$</span>team_url[keep_mask])</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if no display name provided by the function, use all returned urls</span></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>    team_urls_final <span class="ot">&lt;-</span> <span class="fu">unique</span>(team_urls_df<span class="sc">$</span>team_url)</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for each team_url, fetch summer transfers (cached)</span></span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tu <span class="cf">in</span> team_urls_final) {</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"  Fetching summer transfers for: "</span>, tu)</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>    xf <span class="ot">&lt;-</span> <span class="fu">get_team_transfers_cached</span>(tu, sstart)</span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(xf)) <span class="cf">next</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>    dt_xf <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(xf)</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add context columns so you know which country+season they belong to</span></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>    dt_xf[, team_url <span class="sc">:</span><span class="er">=</span> tu]</span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>    dt_xf[, country <span class="sc">:</span><span class="er">=</span> cntry]</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>    dt_xf[, season_start <span class="sc">:</span><span class="er">=</span> sstart]</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setnames</span>(dt_xf, <span class="fu">tolower</span>(<span class="fu">names</span>(dt_xf)))</span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>    all_transfers[[<span class="fu">length</span>(all_transfers) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> dt_xf</span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/afc-bournemouth/startseite/verein/989/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-fulham/startseite/verein/931/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-watford/startseite/verein/1010/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-burnley/startseite/verein/1132/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/huddersfield-town/startseite/verein/1110/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cardiff-city/startseite/verein/603/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/afc-bournemouth/startseite/verein/989/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-watford/startseite/verein/1010/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-burnley/startseite/verein/1132/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/norwich-city/startseite/verein/1123/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sheffield-united/startseite/verein/350/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-fulham/startseite/verein/931/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leeds-united/startseite/verein/399/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sheffield-united/startseite/verein/350/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-bromwich-albion/startseite/verein/984/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-burnley/startseite/verein/1132/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leeds-united/startseite/verein/399/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-brentford/startseite/verein/1148/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/norwich-city/startseite/verein/1123/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-watford/startseite/verein/1010/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-burnley/startseite/verein/1132/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nottingham-forest/startseite/verein/703/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-brentford/startseite/verein/1148/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leeds-united/startseite/verein/399/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-fulham/startseite/verein/931/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/afc-bournemouth/startseite/verein/989/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nottingham-forest/startseite/verein/703/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-brentford/startseite/verein/1148/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/afc-bournemouth/startseite/verein/989/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-fulham/startseite/verein/931/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-burnley/startseite/verein/1132/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sheffield-united/startseite/verein/350/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/luton-town/startseite/verein/1031/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: England | season_start 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-city/startseite/verein/281/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-chelsea/startseite/verein/631/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-liverpool/startseite/verein/31/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/manchester-united/startseite/verein/985/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tottenham-hotspur/startseite/verein/148/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aston-villa/startseite/verein/405/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/newcastle-united/startseite/verein/762/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brighton-amp-hove-albion/startseite/verein/1237/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/crystal-palace/startseite/verein/873/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/afc-bournemouth/startseite/verein/989/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nottingham-forest/startseite/verein/703/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/wolverhampton-wanderers/startseite/verein/543/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-brentford/startseite/verein/1148/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/west-ham-united/startseite/verein/379/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-everton/startseite/verein/29/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-fulham/startseite/verein/931/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-southampton/startseite/verein/180/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ipswich-town/startseite/verein/677/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/leicester-city/startseite/verein/1003/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girondins-bordeaux/startseite/verein/40/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-saint-etienne/startseite/verein/618/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-toulouse/startseite/verein/415/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nimes-olympique/startseite/verein/1160/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ea-guingamp/startseite/verein/855/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/amiens-sc/startseite/verein/1416/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sm-caen/startseite/verein/1162/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/dijon-fco/startseite/verein/2969/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girondins-bordeaux/startseite/verein/40/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-saint-etienne/startseite/verein/618/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-toulouse/startseite/verein/415/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/amiens-sc/startseite/verein/1416/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-metz/startseite/verein/347/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/dijon-fco/startseite/verein/2969/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nimes-olympique/startseite/verein/1160/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-saint-etienne/startseite/verein/618/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girondins-bordeaux/startseite/verein/40/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-lens/startseite/verein/826/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-metz/startseite/verein/347/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-lorient/startseite/verein/1158/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/dijon-fco/startseite/verein/2969/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/nimes-olympique/startseite/verein/1160/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-lens/startseite/verein/826/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girondins-bordeaux/startseite/verein/40/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-saint-etienne/startseite/verein/618/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-metz/startseite/verein/347/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/es-troyes-ac/startseite/verein/1095/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-lorient/startseite/verein/1158/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/clermont-foot-63/startseite/verein/3524/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-lens/startseite/verein/826/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-lorient/startseite/verein/1158/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-toulouse/startseite/verein/415/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/es-troyes-ac/startseite/verein/1095/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aj-auxerre/startseite/verein/290/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/clermont-foot-63/startseite/verein/3524/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-ajaccio/startseite/verein/1147/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-lens/startseite/verein/826/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-toulouse/startseite/verein/415/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-lorient/startseite/verein/1158/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-le-havre/startseite/verein/738/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-metz/startseite/verein/347/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/clermont-foot-63/startseite/verein/3524/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: France | season_start 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-paris-saint-germain/startseite/verein/583/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-monaco/startseite/verein/162/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-marseille/startseite/verein/244/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/losc-lille/startseite/verein/1082/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/olympique-lyon/startseite/verein/1041/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-strassburg-alsace/startseite/verein/667/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/fc-stade-rennes/startseite/verein/273/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ogc-nizza/startseite/verein/417/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rc-lens/startseite/verein/826/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-reims/startseite/verein/1421/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-toulouse/startseite/verein/415/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/fc-nantes/startseite/verein/995/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/stade-brest-29/startseite/verein/3911/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/aj-auxerre/startseite/verein/290/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-saint-etienne/startseite/verein/618/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-le-havre/startseite/verein/738/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/montpellier-hsc/startseite/verein/969/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sco-angers/startseite/verein/1420/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-schalke-04/startseite/verein/33/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hertha-bsc/startseite/verein/44/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fortuna-dusseldorf/startseite/verein/38/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hannover-96/startseite/verein/42/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-nurnberg/startseite/verein/4/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-schalke-04/startseite/verein/33/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hertha-bsc/startseite/verein/44/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-koln/startseite/verein/3/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fortuna-dusseldorf/startseite/verein/38/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-paderborn-07/startseite/verein/127/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hertha-bsc/startseite/verein/44/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-schalke-04/startseite/verein/33/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-koln/startseite/verein/3/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/arminia-bielefeld/startseite/verein/10/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hertha-bsc/startseite/verein/44/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-koln/startseite/verein/3/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/arminia-bielefeld/startseite/verein/10/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-bochum/startseite/verein/80/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spvgg-greuther-furth/startseite/verein/65/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-koln/startseite/verein/3/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hertha-bsc/startseite/verein/44/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-schalke-04/startseite/verein/33/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-bochum/startseite/verein/80/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-koln/startseite/verein/3/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-heidenheim-1846/startseite/verein/2036/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-bochum/startseite/verein/80/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-darmstadt-98/startseite/verein/105/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Germany | season_start 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bayern-munchen/startseite/verein/27/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/bayer-04-leverkusen/startseite/verein/15/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rasenballsport-leipzig/startseite/verein/23826/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-dortmund/startseite/verein/16/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/eintracht-frankfurt/startseite/verein/24/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfb-stuttgart/startseite/verein/79/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-wolfsburg/startseite/verein/82/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/borussia-monchengladbach/startseite/verein/18/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/tsg-1899-hoffenheim/startseite/verein/533/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sc-freiburg/startseite/verein/60/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fsv-mainz-05/startseite/verein/39/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-augsburg/startseite/verein/167/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-union-berlin/startseite/verein/89/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sv-werder-bremen/startseite/verein/86/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/1-fc-heidenheim-1846/startseite/verein/2036/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-st-pauli/startseite/verein/35/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/vfl-bochum/startseite/verein/80/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/holstein-kiel/startseite/verein/269/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sampdoria-genua/startseite/verein/1038/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-empoli/startseite/verein/749/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spal/startseite/verein/2722/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/spal/startseite/verein/2722/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/parma-calcio-1913/startseite/verein/130/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/chievo-verona/startseite/verein/862/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/frosinone-calcio/startseite/verein/8970/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sampdoria-genua/startseite/verein/1038/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/parma-calcio-1913/startseite/verein/130/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/brescia-calcio/startseite/verein/19/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spal/startseite/verein/2722/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/spal/startseite/verein/2722/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-lecce/startseite/verein/1005/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/parma-calcio-1913/startseite/verein/130/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sampdoria-genua/startseite/verein/1038/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spezia-calcio/startseite/verein/3522/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/spezia-calcio/startseite/verein/3522/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-crotone/startseite/verein/4083/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/benevento-calcio/startseite/verein/4171/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sampdoria-genua/startseite/verein/1038/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-empoli/startseite/verein/749/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/venezia-fc/startseite/verein/607/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spezia-calcio/startseite/verein/3522/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-salernitana-1919/startseite/verein/380/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-monza/startseite/verein/2919/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-empoli/startseite/verein/749/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-salernitana-1919/startseite/verein/380/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/spezia-calcio/startseite/verein/3522/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-lecce/startseite/verein/1005/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-cremonese/startseite/verein/2239/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sampdoria-genua/startseite/verein/1038/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-monza/startseite/verein/2919/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-sassuolo/startseite/verein/6574/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/frosinone-calcio/startseite/verein/8970/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/frosinone-calcio/startseite/verein/8970/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-lecce/startseite/verein/1005/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/us-lecce/startseite/verein/1005/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-empoli/startseite/verein/749/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-salernitana-1919/startseite/verein/380/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Italy | season_start 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/inter-mailand/startseite/verein/46/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/juventus-turin/startseite/verein/506/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-mailand/startseite/verein/5/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atalanta-bergamo/startseite/verein/800/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ssc-neapel/startseite/verein/6195/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/as-rom/startseite/verein/12/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-florenz/startseite/verein/430/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-bologna/startseite/verein/1025/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/lazio-rom/startseite/verein/398/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-turin/startseite/verein/416/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/como-1907/startseite/verein/1047/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/udinese-calcio/startseite/verein/410/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/genua-cfc/startseite/verein/252/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/parma-calcio-1913/startseite/verein/130/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/us-lecce/startseite/verein/1005/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/hellas-verona/startseite/verein/276/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-empoli/startseite/verein/749/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ac-monza/startseite/verein/2919/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No transfers found for team: https://www.transfermarkt.com/ac-monza/startseite/verein/2919/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/venezia-fc/startseite/verein/607/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cagliari-calcio/startseite/verein/1390/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/espanyol-barcelona/startseite/verein/714/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cd-leganes/startseite/verein/1244/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-levante/startseite/verein/3368/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girona/startseite/verein/12321/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sd-eibar/startseite/verein/1533/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rayo-vallecano/startseite/verein/367/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-valladolid/startseite/verein/366/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sd-huesca/startseite/verein/5358/saison_id/2018</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/espanyol-barcelona/startseite/verein/714/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cd-leganes/startseite/verein/1244/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-levante/startseite/verein/3368/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-valladolid/startseite/verein/366/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rcd-mallorca/startseite/verein/237/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-granada/startseite/verein/16795/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sd-eibar/startseite/verein/1533/saison_id/2019</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-granada/startseite/verein/16795/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-levante/startseite/verein/3368/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sd-eibar/startseite/verein/1533/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/sd-huesca/startseite/verein/5358/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-valladolid/startseite/verein/366/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-cadiz/startseite/verein/2687/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-elche/startseite/verein/1531/saison_id/2020</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/espanyol-barcelona/startseite/verein/714/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-granada/startseite/verein/16795/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-levante/startseite/verein/3368/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rcd-mallorca/startseite/verein/237/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-elche/startseite/verein/1531/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-cadiz/startseite/verein/2687/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rayo-vallecano/startseite/verein/367/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2021</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girona/startseite/verein/12321/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/espanyol-barcelona/startseite/verein/714/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-almeria/startseite/verein/3302/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rcd-mallorca/startseite/verein/237/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rayo-vallecano/startseite/verein/367/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-valladolid/startseite/verein/366/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-elche/startseite/verein/1531/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-cadiz/startseite/verein/2687/saison_id/2022</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girona/startseite/verein/12321/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-granada/startseite/verein/16795/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-las-palmas/startseite/verein/472/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-almeria/startseite/verein/3302/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rcd-mallorca/startseite/verein/237/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rayo-vallecano/startseite/verein/367/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-cadiz/startseite/verein/2687/saison_id/2023</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing: Spain | season_start 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-madrid/startseite/verein/418/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-barcelona/startseite/verein/131/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/atletico-madrid/startseite/verein/13/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/athletic-bilbao/startseite/verein/621/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-sociedad-san-sebastian/startseite/verein/681/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-betis-sevilla/startseite/verein/150/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-villarreal/startseite/verein/1050/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-valencia/startseite/verein/1049/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-sevilla/startseite/verein/368/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-girona/startseite/verein/12321/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/celta-vigo/startseite/verein/940/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ud-las-palmas/startseite/verein/472/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/espanyol-barcelona/startseite/verein/714/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/ca-osasuna/startseite/verein/331/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/deportivo-alaves/startseite/verein/1108/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/fc-getafe/startseite/verein/3709/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rcd-mallorca/startseite/verein/237/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/real-valladolid/startseite/verein/366/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/rayo-vallecano/startseite/verein/367/saison_id/2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  Fetching summer transfers for: https://www.transfermarkt.com/cd-leganes/startseite/verein/1244/saison_id/2024</code></pre>
</div>
<div class="sourceCode cell-code" id="cb786"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb786-1"><a href="#cb786-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- 3) combine and save ----------</span></span>
<span id="cb786-2"><a href="#cb786-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(all_transfers) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb786-3"><a href="#cb786-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"No transfers fetched. Check that tm_league_team_urls() and tm_team_transfers() work in your environment."</span>)</span>
<span id="cb786-4"><a href="#cb786-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb786-5"><a href="#cb786-5" aria-hidden="true" tabindex="-1"></a>  transfers_dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_transfers, <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb786-6"><a href="#cb786-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add season numeric and save</span></span>
<span id="cb786-7"><a href="#cb786-7" aria-hidden="true" tabindex="-1"></a>  transfers_dt[, season <span class="sc">:</span><span class="er">=</span> season_start]</span>
<span id="cb786-8"><a href="#cb786-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fwrite</span>(transfers_dt, out_csv)</span>
<span id="cb786-9"><a href="#cb786-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Saved summer transfers to: "</span>, out_csv)</span>
<span id="cb786-10"><a href="#cb786-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Cached per-team rds files are in: "</span>, cache_dir)</span>
<span id="cb786-11"><a href="#cb786-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved summer transfers to: ~/sem3/research_project/rival_analysis/data/transfers_summer_2018_2025.csv</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cached per-team rds files are in: ~/sem3/research_project/rival_analysis/data/transfers_cache</code></pre>
</div>
</div>
<section id="filtering-out-transfers---only-within-teams-from-the-top5-leagues" class="level3">
<h3 class="anchored" data-anchor-id="filtering-out-transfers---only-within-teams-from-the-top5-leagues">Filtering out transfers - only within teams from the top5 leagues</h3>
<p>The above data contains transfers that happened for teams from the top 5 leagues. But, it doesn’t necessarily mean that all such transfers happened within the top 5 leagues. Teams also buy players from other leagues. So, we add a filter such that both the seller and buyer teams must be within the top 5 leagues for our observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb789"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb789-1"><a href="#cb789-1" aria-hidden="true" tabindex="-1"></a>transfers_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/transfers_summer_2018_2025.csv"</span></span>
<span id="cb789-2"><a href="#cb789-2" aria-hidden="true" tabindex="-1"></a>transfers  <span class="ot">&lt;-</span> <span class="fu">fread</span>(transfers_path)</span>
<span id="cb789-3"><a href="#cb789-3" aria-hidden="true" tabindex="-1"></a>league_table <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span>)</span>
<span id="cb789-4"><a href="#cb789-4" aria-hidden="true" tabindex="-1"></a>top5_leagues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Premier League"</span>, <span class="st">"LaLiga"</span>, <span class="st">"Bundesliga"</span>, <span class="st">"Ligue 1"</span>, <span class="st">"Serie A"</span>)</span>
<span id="cb789-5"><a href="#cb789-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb789-6"><a href="#cb789-6" aria-hidden="true" tabindex="-1"></a>top5_league_transfers <span class="ot">&lt;-</span> <span class="fu">filter</span>(transfers,</span>
<span id="cb789-7"><a href="#cb789-7" aria-hidden="true" tabindex="-1"></a>       league <span class="sc">%in%</span> top5_leagues,</span>
<span id="cb789-8"><a href="#cb789-8" aria-hidden="true" tabindex="-1"></a>       league_2 <span class="sc">%in%</span> top5_leagues)</span>
<span id="cb789-9"><a href="#cb789-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(top5_league_transfers, <span class="st">"~/sem3/research_project/rival_analysis/data/top5_league_transfers.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="mapping" class="level2">
<h2 class="anchored" data-anchor-id="mapping">Mapping</h2>
<p>Before we proceed with analysis, we try to map the team names between the different tables we have gathered so far.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb790"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb790-1"><a href="#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== PATHS ===================== ##</span></span>
<span id="cb790-2"><a href="#cb790-2" aria-hidden="true" tabindex="-1"></a>rivals_path    <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/season_rivalries_elo_combined.csv"</span></span>
<span id="cb790-3"><a href="#cb790-3" aria-hidden="true" tabindex="-1"></a>transfers_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/top5_league_transfers.csv"</span></span>
<span id="cb790-4"><a href="#cb790-4" aria-hidden="true" tabindex="-1"></a>league_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span></span>
<span id="cb790-5"><a href="#cb790-5" aria-hidden="true" tabindex="-1"></a>out_dir     <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data"</span></span>
<span id="cb790-6"><a href="#cb790-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-7"><a href="#cb790-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 1. LOAD DATA ===================== ##</span></span>
<span id="cb790-8"><a href="#cb790-8" aria-hidden="true" tabindex="-1"></a>league <span class="ot">&lt;-</span> <span class="fu">fread</span>(league_path)</span>
<span id="cb790-9"><a href="#cb790-9" aria-hidden="true" tabindex="-1"></a>xf     <span class="ot">&lt;-</span> <span class="fu">fread</span>(transfers_path)</span>
<span id="cb790-10"><a href="#cb790-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-11"><a href="#cb790-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 2. BUILD CANONICAL TEAM LIST ===================== ##</span></span>
<span id="cb790-12"><a href="#cb790-12" aria-hidden="true" tabindex="-1"></a><span class="co"># League table defines truth</span></span>
<span id="cb790-13"><a href="#cb790-13" aria-hidden="true" tabindex="-1"></a>league[, team_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(squad))]</span>
<span id="cb790-14"><a href="#cb790-14" aria-hidden="true" tabindex="-1"></a>league[, country <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(country)]</span>
<span id="cb790-15"><a href="#cb790-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-16"><a href="#cb790-16" aria-hidden="true" tabindex="-1"></a>canon_teams <span class="ot">&lt;-</span> <span class="fu">unique</span>(</span>
<span id="cb790-17"><a href="#cb790-17" aria-hidden="true" tabindex="-1"></a>  league[, .(country, team_clean)]</span>
<span id="cb790-18"><a href="#cb790-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb790-19"><a href="#cb790-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-20"><a href="#cb790-20" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 3. EXTRACT RAW TRANSFER TEAM NAMES ===================== ##</span></span>
<span id="cb790-21"><a href="#cb790-21" aria-hidden="true" tabindex="-1"></a>xf[, buyer_raw  <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team_name))]</span>
<span id="cb790-22"><a href="#cb790-22" aria-hidden="true" tabindex="-1"></a>xf[, seller_raw <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(club_2))]</span>
<span id="cb790-23"><a href="#cb790-23" aria-hidden="true" tabindex="-1"></a>xf[, country    <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(country)]</span>
<span id="cb790-24"><a href="#cb790-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-25"><a href="#cb790-25" aria-hidden="true" tabindex="-1"></a>raw_teams <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">rbind</span>(</span>
<span id="cb790-26"><a href="#cb790-26" aria-hidden="true" tabindex="-1"></a>  xf[, .(country, <span class="at">raw =</span> buyer_raw)]</span>
<span id="cb790-27"><a href="#cb790-27" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb790-28"><a href="#cb790-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-29"><a href="#cb790-29" aria-hidden="true" tabindex="-1"></a>valid_canon <span class="ot">&lt;-</span> canon_teams[, .(country, team_clean)]</span>
<span id="cb790-30"><a href="#cb790-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-31"><a href="#cb790-31" aria-hidden="true" tabindex="-1"></a>raw_teams <span class="ot">&lt;-</span> raw_teams[</span>
<span id="cb790-32"><a href="#cb790-32" aria-hidden="true" tabindex="-1"></a>  country <span class="sc">%in%</span> valid_canon<span class="sc">$</span>country</span>
<span id="cb790-33"><a href="#cb790-33" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb790-34"><a href="#cb790-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-35"><a href="#cb790-35" aria-hidden="true" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb790-36"><a href="#cb790-36" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb790-37"><a href="#cb790-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tolower</span>() <span class="sc">|&gt;</span></span>
<span id="cb790-38"><a href="#cb790-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"&amp;"</span>, <span class="st">"and"</span>) <span class="sc">|&gt;</span></span>
<span id="cb790-39"><a href="#cb790-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[^a-z ]"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb790-40"><a href="#cb790-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_squish</span>()</span>
<span id="cb790-41"><a href="#cb790-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb790-42"><a href="#cb790-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-43"><a href="#cb790-43" aria-hidden="true" tabindex="-1"></a>valid_canon[, team_norm <span class="sc">:</span><span class="er">=</span> <span class="fu">normalize</span>(team_clean)]</span>
<span id="cb790-44"><a href="#cb790-44" aria-hidden="true" tabindex="-1"></a>raw_teams[, raw_norm <span class="sc">:</span><span class="er">=</span> <span class="fu">normalize</span>(raw)]</span>
<span id="cb790-45"><a href="#cb790-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-46"><a href="#cb790-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-47"><a href="#cb790-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 4. FUZZY MATCH (RAW → CANONICAL) ===================== ##</span></span>
<span id="cb790-48"><a href="#cb790-48" aria-hidden="true" tabindex="-1"></a>team_map <span class="ot">&lt;-</span> <span class="fu">stringdist_inner_join</span>(</span>
<span id="cb790-49"><a href="#cb790-49" aria-hidden="true" tabindex="-1"></a>  raw_teams,</span>
<span id="cb790-50"><a href="#cb790-50" aria-hidden="true" tabindex="-1"></a>  valid_canon,</span>
<span id="cb790-51"><a href="#cb790-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"team_clean"</span>),</span>
<span id="cb790-52"><a href="#cb790-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"jw"</span>,</span>
<span id="cb790-53"><a href="#cb790-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_dist =</span> <span class="fl">0.2</span>,</span>
<span id="cb790-54"><a href="#cb790-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance_col =</span> <span class="st">"dist"</span></span>
<span id="cb790-55"><a href="#cb790-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb790-56"><a href="#cb790-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-57"><a href="#cb790-57" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: force data.table</span></span>
<span id="cb790-58"><a href="#cb790-58" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(team_map)</span>
<span id="cb790-59"><a href="#cb790-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-60"><a href="#cb790-60" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 5. FIX country.x / country.y ===================== ##</span></span>
<span id="cb790-61"><a href="#cb790-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only same-country matches</span></span>
<span id="cb790-62"><a href="#cb790-62" aria-hidden="true" tabindex="-1"></a>team_map <span class="ot">&lt;-</span> team_map[country.x <span class="sc">==</span> country.y]</span>
<span id="cb790-63"><a href="#cb790-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-64"><a href="#cb790-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names</span></span>
<span id="cb790-65"><a href="#cb790-65" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(team_map, <span class="st">"country.x"</span>, <span class="st">"country"</span>)</span>
<span id="cb790-66"><a href="#cb790-66" aria-hidden="true" tabindex="-1"></a>team_map[, country.y <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb790-67"><a href="#cb790-67" aria-hidden="true" tabindex="-1"></a>team_map[, country.dist <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in `[.data.table`(team_map, , `:=`(country.dist, NULL)): Tried to
assign NULL to column 'country.dist', but this column does not exist to remove</code></pre>
</div>
<div class="sourceCode cell-code" id="cb792"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb792-1"><a href="#cb792-1" aria-hidden="true" tabindex="-1"></a>team_map[, raw.dist <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in `[.data.table`(team_map, , `:=`(raw.dist, NULL)): Tried to assign
NULL to column 'raw.dist', but this column does not exist to remove</code></pre>
</div>
<div class="sourceCode cell-code" id="cb794"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb794-1"><a href="#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep best match per (country, raw)</span></span>
<span id="cb794-2"><a href="#cb794-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(team_map, country, raw, dist)</span>
<span id="cb794-3"><a href="#cb794-3" aria-hidden="true" tabindex="-1"></a>team_map <span class="ot">&lt;-</span> team_map[, .SD[<span class="dv">1</span>], by <span class="ot">=</span> .(country, raw)]</span>
<span id="cb794-4"><a href="#cb794-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-5"><a href="#cb794-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-6"><a href="#cb794-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 6. QA CHECKS ===================== ##</span></span>
<span id="cb794-7"><a href="#cb794-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Unmatched raw names (inspect &amp; manually fix if needed)</span></span>
<span id="cb794-8"><a href="#cb794-8" aria-hidden="true" tabindex="-1"></a>unmatched <span class="ot">&lt;-</span> raw_teams[<span class="sc">!</span>raw <span class="sc">%in%</span> team_map<span class="sc">$</span>raw]</span>
<span id="cb794-9"><a href="#cb794-9" aria-hidden="true" tabindex="-1"></a><span class="co"># fwrite(unmatched, file.path(out_dir, "unmatched_transfer_teams.csv"))</span></span>
<span id="cb794-10"><a href="#cb794-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-11"><a href="#cb794-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Unmatched raw team names saved to unmatched_transfer_teams.csv</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unmatched raw team names saved to unmatched_transfer_teams.csv</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb796"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb796-1"><a href="#cb796-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 7. APPLY MAPPING TO TRANSFERS ===================== ##</span></span>
<span id="cb796-2"><a href="#cb796-2" aria-hidden="true" tabindex="-1"></a>manual_map <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"~/sem3/research_project/rival_analysis/data/unmatched_transfer_teams.csv"</span>)</span>
<span id="cb796-3"><a href="#cb796-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-4"><a href="#cb796-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rivalries: teams</span></span>
<span id="cb796-5"><a href="#cb796-5" aria-hidden="true" tabindex="-1"></a>riv <span class="ot">&lt;-</span> <span class="fu">fread</span>(rivals_path)</span>
<span id="cb796-6"><a href="#cb796-6" aria-hidden="true" tabindex="-1"></a>riv[, team_a_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team_a))]</span>
<span id="cb796-7"><a href="#cb796-7" aria-hidden="true" tabindex="-1"></a>riv[, team_b_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team_b))]</span>
<span id="cb796-8"><a href="#cb796-8" aria-hidden="true" tabindex="-1"></a>riv[, season       <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(season)]</span>
<span id="cb796-9"><a href="#cb796-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-10"><a href="#cb796-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 3. BUILD DEDUPLICATED RIVAL LOOKUP ===================== ##</span></span>
<span id="cb796-11"><a href="#cb796-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse to unique rival pairs per country-season-teamA-teamB</span></span>
<span id="cb796-12"><a href="#cb796-12" aria-hidden="true" tabindex="-1"></a>riv_unique <span class="ot">&lt;-</span> riv[</span>
<span id="cb796-13"><a href="#cb796-13" aria-hidden="true" tabindex="-1"></a>  is_rival <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb796-14"><a href="#cb796-14" aria-hidden="true" tabindex="-1"></a>  .(country, season, team_a_clean, team_b_clean)</span>
<span id="cb796-15"><a href="#cb796-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb796-16"><a href="#cb796-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-17"><a href="#cb796-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure uniqueness (this removes pos+elo duplicates)</span></span>
<span id="cb796-18"><a href="#cb796-18" aria-hidden="true" tabindex="-1"></a>riv_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(riv_unique)</span>
<span id="cb796-19"><a href="#cb796-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-20"><a href="#cb796-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Build bidirectional lookup</span></span>
<span id="cb796-21"><a href="#cb796-21" aria-hidden="true" tabindex="-1"></a>riv_long <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb796-22"><a href="#cb796-22" aria-hidden="true" tabindex="-1"></a>  riv_unique[, .(country, season, <span class="at">from =</span> team_a_clean, <span class="at">to =</span> team_b_clean, <span class="at">is_rival =</span> <span class="cn">TRUE</span>)],</span>
<span id="cb796-23"><a href="#cb796-23" aria-hidden="true" tabindex="-1"></a>  riv_unique[, .(country, season, <span class="at">from =</span> team_b_clean, <span class="at">to =</span> team_a_clean, <span class="at">is_rival =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb796-24"><a href="#cb796-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb796-25"><a href="#cb796-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-26"><a href="#cb796-26" aria-hidden="true" tabindex="-1"></a>team_map_final <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">rbind</span>(</span>
<span id="cb796-27"><a href="#cb796-27" aria-hidden="true" tabindex="-1"></a>  team_map[, .(country, raw, team_clean)],</span>
<span id="cb796-28"><a href="#cb796-28" aria-hidden="true" tabindex="-1"></a>  manual_map</span>
<span id="cb796-29"><a href="#cb796-29" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb796-30"><a href="#cb796-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-31"><a href="#cb796-31" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb796-32"><a href="#cb796-32" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb796-33"><a href="#cb796-33" aria-hidden="true" tabindex="-1"></a>  team_map_final,</span>
<span id="cb796-34"><a href="#cb796-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"buyer_raw"</span>),</span>
<span id="cb796-35"><a href="#cb796-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"raw"</span>),</span>
<span id="cb796-36"><a href="#cb796-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb796-37"><a href="#cb796-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb796-38"><a href="#cb796-38" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(xf, <span class="st">"team_clean"</span>, <span class="st">"buyer_clean"</span>)</span>
<span id="cb796-39"><a href="#cb796-39" aria-hidden="true" tabindex="-1"></a>dup_last <span class="ot">&lt;-</span> <span class="fu">duplicated</span>(<span class="fu">names</span>(xf), <span class="at">fromLast =</span> <span class="cn">TRUE</span>)</span>
<span id="cb796-40"><a href="#cb796-40" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> xf[, <span class="sc">!</span>dup_last, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb796-41"><a href="#cb796-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Sellers (needed for rivalry tagging)</span></span>
<span id="cb796-42"><a href="#cb796-42" aria-hidden="true" tabindex="-1"></a><span class="co"># xf &lt;- merge(</span></span>
<span id="cb796-43"><a href="#cb796-43" aria-hidden="true" tabindex="-1"></a><span class="co">#  xf,</span></span>
<span id="cb796-44"><a href="#cb796-44" aria-hidden="true" tabindex="-1"></a><span class="co">#  team_map_final,</span></span>
<span id="cb796-45"><a href="#cb796-45" aria-hidden="true" tabindex="-1"></a><span class="co"># by.x = c("country", "seller_raw"),</span></span>
<span id="cb796-46"><a href="#cb796-46" aria-hidden="true" tabindex="-1"></a><span class="co"># by.y = c("country", "raw"),</span></span>
<span id="cb796-47"><a href="#cb796-47" aria-hidden="true" tabindex="-1"></a><span class="co">#  all.x = TRUE</span></span>
<span id="cb796-48"><a href="#cb796-48" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb796-49"><a href="#cb796-49" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(xf, <span class="st">"seller_raw"</span>, <span class="st">"seller_clean"</span>)</span>
<span id="cb796-50"><a href="#cb796-50" aria-hidden="true" tabindex="-1"></a>dup <span class="ot">&lt;-</span> <span class="fu">duplicated</span>(<span class="fu">names</span>(xf))</span>
<span id="cb796-51"><a href="#cb796-51" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> xf[, <span class="sc">!</span>dup, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb796-52"><a href="#cb796-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-53"><a href="#cb796-53" aria-hidden="true" tabindex="-1"></a>xf[, is_rival <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in `[.data.table`(xf, , `:=`(is_rival, NULL)): Tried to assign NULL to
column 'is_rival', but this column does not exist to remove</code></pre>
</div>
<div class="sourceCode cell-code" id="cb798"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb798-1"><a href="#cb798-1" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb798-2"><a href="#cb798-2" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb798-3"><a href="#cb798-3" aria-hidden="true" tabindex="-1"></a>  riv_long,</span>
<span id="cb798-4"><a href="#cb798-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"seller_clean"</span>, <span class="st">"buyer_clean"</span>),</span>
<span id="cb798-5"><a href="#cb798-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"from"</span>, <span class="st">"to"</span>),</span>
<span id="cb798-6"><a href="#cb798-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb798-7"><a href="#cb798-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb798-8"><a href="#cb798-8" aria-hidden="true" tabindex="-1"></a>xf[, is_rival <span class="sc">:</span><span class="er">=</span> <span class="sc">!</span><span class="fu">is.na</span>(is_rival)]</span>
<span id="cb798-9"><a href="#cb798-9" aria-hidden="true" tabindex="-1"></a>xf[, pos_clean        <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(player_position))]</span>
<span id="cb798-10"><a href="#cb798-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb798-11"><a href="#cb798-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(xf, <span class="st">"~/sem3/research_project/rival_analysis/data/top5_league_transfers_clean.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="opportunity-set" class="level2">
<h2 class="anchored" data-anchor-id="opportunity-set">Opportunity Set</h2>
<p>Next, we build the opportunity set. We try to find alternative choices for a rival transfer. We count:</p>
<ul>
<li><p>Total rival options available (rivalry is local to a league)</p></li>
<li><p>Non-rival options available within the league</p></li>
<li><p>Global non-rival options (top 5 leagues)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb799"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb799-1"><a href="#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 0. FILE PATHS ===================== ##</span></span>
<span id="cb799-2"><a href="#cb799-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Change these to your real paths if needed</span></span>
<span id="cb799-3"><a href="#cb799-3" aria-hidden="true" tabindex="-1"></a>transfers_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/top5_league_transfers_clean.csv"</span></span>
<span id="cb799-4"><a href="#cb799-4" aria-hidden="true" tabindex="-1"></a>league_dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span>)</span>
<span id="cb799-5"><a href="#cb799-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-6"><a href="#cb799-6" aria-hidden="true" tabindex="-1"></a>league_dt[, team_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(squad))]</span>
<span id="cb799-7"><a href="#cb799-7" aria-hidden="true" tabindex="-1"></a>league_dt[, season <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(<span class="fu">sub</span>(<span class="st">"([0-9]{4}).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, season))]</span>
<span id="cb799-8"><a href="#cb799-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-9"><a href="#cb799-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 1. LOAD DATA ===================== ##</span></span>
<span id="cb799-10"><a href="#cb799-10" aria-hidden="true" tabindex="-1"></a>riv <span class="ot">&lt;-</span> <span class="fu">fread</span>(rivals_path)</span>
<span id="cb799-11"><a href="#cb799-11" aria-hidden="true" tabindex="-1"></a>xf  <span class="ot">&lt;-</span> <span class="fu">fread</span>(transfers_path)</span>
<span id="cb799-12"><a href="#cb799-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-13"><a href="#cb799-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Your transfers file is already summer-only, but in case you kept both windows:</span></span>
<span id="cb799-14"><a href="#cb799-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"window"</span> <span class="sc">%in%</span> <span class="fu">names</span>(xf)) {</span>
<span id="cb799-15"><a href="#cb799-15" aria-hidden="true" tabindex="-1"></a>  xf <span class="ot">&lt;-</span> xf[window <span class="sc">==</span> <span class="st">"Summer"</span>]</span>
<span id="cb799-16"><a href="#cb799-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb799-17"><a href="#cb799-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"transfer_type"</span> <span class="sc">%in%</span> <span class="fu">names</span>(xf)) {</span>
<span id="cb799-18"><a href="#cb799-18" aria-hidden="true" tabindex="-1"></a>  xf <span class="ot">&lt;-</span> xf[transfer_type <span class="sc">==</span> <span class="st">"Arrivals"</span>]</span>
<span id="cb799-19"><a href="#cb799-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb799-20"><a href="#cb799-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-21"><a href="#cb799-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude loans from the analysis</span></span>
<span id="cb799-22"><a href="#cb799-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"is_loan"</span> <span class="sc">%in%</span> <span class="fu">names</span>(xf)) {</span>
<span id="cb799-23"><a href="#cb799-23" aria-hidden="true" tabindex="-1"></a>  xf <span class="ot">&lt;-</span> xf[is_loan <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">|</span> <span class="fu">is.na</span>(is_loan)]</span>
<span id="cb799-24"><a href="#cb799-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb799-25"><a href="#cb799-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-26"><a href="#cb799-26" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 2. CLEAN &amp; STANDARDISE ===================== ##</span></span>
<span id="cb799-27"><a href="#cb799-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-28"><a href="#cb799-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Rivalries: teams</span></span>
<span id="cb799-29"><a href="#cb799-29" aria-hidden="true" tabindex="-1"></a>riv[, team_a_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team_a))]</span>
<span id="cb799-30"><a href="#cb799-30" aria-hidden="true" tabindex="-1"></a>riv[, team_b_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(team_b))]</span>
<span id="cb799-31"><a href="#cb799-31" aria-hidden="true" tabindex="-1"></a>riv[, season       <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(season)]</span>
<span id="cb799-32"><a href="#cb799-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-33"><a href="#cb799-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 3. BUILD DEDUPLICATED RIVAL LOOKUP ===================== ##</span></span>
<span id="cb799-34"><a href="#cb799-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse to unique rival pairs per country-season-teamA-teamB</span></span>
<span id="cb799-35"><a href="#cb799-35" aria-hidden="true" tabindex="-1"></a>riv_unique <span class="ot">&lt;-</span> riv[</span>
<span id="cb799-36"><a href="#cb799-36" aria-hidden="true" tabindex="-1"></a>  is_rival <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb799-37"><a href="#cb799-37" aria-hidden="true" tabindex="-1"></a>  .(country, season, team_a_clean, team_b_clean)</span>
<span id="cb799-38"><a href="#cb799-38" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-39"><a href="#cb799-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-40"><a href="#cb799-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure uniqueness (this removes pos+elo duplicates)</span></span>
<span id="cb799-41"><a href="#cb799-41" aria-hidden="true" tabindex="-1"></a>riv_unique <span class="ot">&lt;-</span> <span class="fu">unique</span>(riv_unique)</span>
<span id="cb799-42"><a href="#cb799-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-43"><a href="#cb799-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-44"><a href="#cb799-44" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== SAME-LEAGUE FLAG (FIXED) ===================== ##</span></span>
<span id="cb799-45"><a href="#cb799-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Build lookup of all same-league team pairs (ignoring rivalry)</span></span>
<span id="cb799-46"><a href="#cb799-46" aria-hidden="true" tabindex="-1"></a>same_league_pairs <span class="ot">&lt;-</span> riv_unique[</span>
<span id="cb799-47"><a href="#cb799-47" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb799-48"><a href="#cb799-48" aria-hidden="true" tabindex="-1"></a>  .(country, season,</span>
<span id="cb799-49"><a href="#cb799-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">seller_clean =</span> team_a_clean,</span>
<span id="cb799-50"><a href="#cb799-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">buyer_clean  =</span> team_b_clean)</span>
<span id="cb799-51"><a href="#cb799-51" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-52"><a href="#cb799-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-53"><a href="#cb799-53" aria-hidden="true" tabindex="-1"></a>same_league_pairs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">rbind</span>(</span>
<span id="cb799-54"><a href="#cb799-54" aria-hidden="true" tabindex="-1"></a>  same_league_pairs,</span>
<span id="cb799-55"><a href="#cb799-55" aria-hidden="true" tabindex="-1"></a>  same_league_pairs[, .(country, season,</span>
<span id="cb799-56"><a href="#cb799-56" aria-hidden="true" tabindex="-1"></a>                        <span class="at">seller_clean =</span> buyer_clean,</span>
<span id="cb799-57"><a href="#cb799-57" aria-hidden="true" tabindex="-1"></a>                        <span class="at">buyer_clean  =</span> seller_clean)]</span>
<span id="cb799-58"><a href="#cb799-58" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb799-59"><a href="#cb799-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-60"><a href="#cb799-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add explicit indicator column</span></span>
<span id="cb799-61"><a href="#cb799-61" aria-hidden="true" tabindex="-1"></a>same_league_pairs[, same_league <span class="sc">:</span><span class="er">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb799-62"><a href="#cb799-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-63"><a href="#cb799-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge indicator into transfers</span></span>
<span id="cb799-64"><a href="#cb799-64" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-65"><a href="#cb799-65" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb799-66"><a href="#cb799-66" aria-hidden="true" tabindex="-1"></a>  same_league_pairs,</span>
<span id="cb799-67"><a href="#cb799-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"seller_clean"</span>, <span class="st">"buyer_clean"</span>),</span>
<span id="cb799-68"><a href="#cb799-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-69"><a href="#cb799-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-70"><a href="#cb799-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-71"><a href="#cb799-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Proper logical flag</span></span>
<span id="cb799-72"><a href="#cb799-72" aria-hidden="true" tabindex="-1"></a>xf[, same_league <span class="sc">:</span><span class="er">=</span> <span class="sc">!</span><span class="fu">is.na</span>(same_league)]</span>
<span id="cb799-73"><a href="#cb799-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-74"><a href="#cb799-74" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== LEAGUE MEMBERSHIP FLAGS ===================== ##</span></span>
<span id="cb799-75"><a href="#cb799-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-76"><a href="#cb799-76" aria-hidden="true" tabindex="-1"></a><span class="co"># buyer in league</span></span>
<span id="cb799-77"><a href="#cb799-77" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-78"><a href="#cb799-78" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb799-79"><a href="#cb799-79" aria-hidden="true" tabindex="-1"></a>  league_dt[, .(country, season, <span class="at">buyer_clean =</span> team_clean, <span class="at">buyer_in_league =</span> <span class="cn">TRUE</span>)],</span>
<span id="cb799-80"><a href="#cb799-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"buyer_clean"</span>),</span>
<span id="cb799-81"><a href="#cb799-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-82"><a href="#cb799-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-83"><a href="#cb799-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-84"><a href="#cb799-84" aria-hidden="true" tabindex="-1"></a><span class="co"># seller in league</span></span>
<span id="cb799-85"><a href="#cb799-85" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-86"><a href="#cb799-86" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb799-87"><a href="#cb799-87" aria-hidden="true" tabindex="-1"></a>  league_dt[, .(country, season, <span class="at">seller_clean =</span> team_clean, <span class="at">seller_in_league =</span> <span class="cn">TRUE</span>)],</span>
<span id="cb799-88"><a href="#cb799-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"seller_clean"</span>),</span>
<span id="cb799-89"><a href="#cb799-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-90"><a href="#cb799-90" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-91"><a href="#cb799-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-92"><a href="#cb799-92" aria-hidden="true" tabindex="-1"></a><span class="co"># define same-league transfer</span></span>
<span id="cb799-93"><a href="#cb799-93" aria-hidden="true" tabindex="-1"></a>xf[, same_league <span class="sc">:</span><span class="er">=</span> buyer_in_league <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> seller_in_league <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb799-94"><a href="#cb799-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-95"><a href="#cb799-95" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NAs</span></span>
<span id="cb799-96"><a href="#cb799-96" aria-hidden="true" tabindex="-1"></a>xf[<span class="fu">is.na</span>(same_league), same_league <span class="sc">:</span><span class="er">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb799-97"><a href="#cb799-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-98"><a href="#cb799-98" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== OPTION POOLS (FIXED) ===================== ##</span></span>
<span id="cb799-99"><a href="#cb799-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-100"><a href="#cb799-100" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) League-restricted non-rival options</span></span>
<span id="cb799-101"><a href="#cb799-101" aria-hidden="true" tabindex="-1"></a>non_rival_pool <span class="ot">&lt;-</span> xf[</span>
<span id="cb799-102"><a href="#cb799-102" aria-hidden="true" tabindex="-1"></a>  same_league <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> is_rival <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb799-103"><a href="#cb799-103" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">non_rival_options =</span> .N),</span>
<span id="cb799-104"><a href="#cb799-104" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season, pos_clean)</span>
<span id="cb799-105"><a href="#cb799-105" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-106"><a href="#cb799-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-107"><a href="#cb799-107" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) Global non-rival options</span></span>
<span id="cb799-108"><a href="#cb799-108" aria-hidden="true" tabindex="-1"></a>global_non_rival_pool <span class="ot">&lt;-</span> xf[</span>
<span id="cb799-109"><a href="#cb799-109" aria-hidden="true" tabindex="-1"></a>  is_rival <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb799-110"><a href="#cb799-110" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">global_non_rival_options =</span> .N),</span>
<span id="cb799-111"><a href="#cb799-111" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(season, pos_clean)</span>
<span id="cb799-112"><a href="#cb799-112" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-113"><a href="#cb799-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-114"><a href="#cb799-114" aria-hidden="true" tabindex="-1"></a>total_rival_pool <span class="ot">&lt;-</span> xf[</span>
<span id="cb799-115"><a href="#cb799-115" aria-hidden="true" tabindex="-1"></a>  same_league <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> is_rival <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb799-116"><a href="#cb799-116" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">total_rival_options =</span> .N),</span>
<span id="cb799-117"><a href="#cb799-117" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season, pos_clean)</span>
<span id="cb799-118"><a href="#cb799-118" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-119"><a href="#cb799-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-120"><a href="#cb799-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-121"><a href="#cb799-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-122"><a href="#cb799-122" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------- Q1: HOW MANY TRANSFERS ARE FROM RIVALS? ---------------- ##</span></span>
<span id="cb799-123"><a href="#cb799-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Per team-season</span></span>
<span id="cb799-124"><a href="#cb799-124" aria-hidden="true" tabindex="-1"></a>rival_counts_team_season <span class="ot">&lt;-</span> xf[</span>
<span id="cb799-125"><a href="#cb799-125" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb799-126"><a href="#cb799-126" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb799-127"><a href="#cb799-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_transfers =</span> .N,</span>
<span id="cb799-128"><a href="#cb799-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_transfers =</span> <span class="fu">sum</span>(is_rival),</span>
<span id="cb799-129"><a href="#cb799-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_rival     =</span> <span class="fu">sum</span>(is_rival) <span class="sc">/</span> .N</span>
<span id="cb799-130"><a href="#cb799-130" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb799-131"><a href="#cb799-131" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season, buyer_clean)</span>
<span id="cb799-132"><a href="#cb799-132" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-133"><a href="#cb799-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-134"><a href="#cb799-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall per country-season (optional)</span></span>
<span id="cb799-135"><a href="#cb799-135" aria-hidden="true" tabindex="-1"></a>rival_counts_season <span class="ot">&lt;-</span> xf[</span>
<span id="cb799-136"><a href="#cb799-136" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb799-137"><a href="#cb799-137" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb799-138"><a href="#cb799-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_transfers =</span> .N,</span>
<span id="cb799-139"><a href="#cb799-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_transfers =</span> <span class="fu">sum</span>(is_rival),</span>
<span id="cb799-140"><a href="#cb799-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_rival     =</span> <span class="fu">sum</span>(is_rival) <span class="sc">/</span> .N</span>
<span id="cb799-141"><a href="#cb799-141" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb799-142"><a href="#cb799-142" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season)</span>
<span id="cb799-143"><a href="#cb799-143" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-144"><a href="#cb799-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-145"><a href="#cb799-145" aria-hidden="true" tabindex="-1"></a><span class="co"># You can inspect or save these:</span></span>
<span id="cb799-146"><a href="#cb799-146" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(rival_counts_team_season, <span class="st">"~/sem3/research_project/rival_analysis/data/teamwise_transfer_ratio.csv"</span>)</span>
<span id="cb799-147"><a href="#cb799-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-148"><a href="#cb799-148" aria-hidden="true" tabindex="-1"></a>cols_to_drop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"same_league"</span>, <span class="st">"buyer_in_league"</span>, <span class="st">"seller_in_league"</span>)</span>
<span id="cb799-149"><a href="#cb799-149" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(xf[, <span class="sc">!</span>..cols_to_drop], <span class="st">"~/sem3/research_project/rival_analysis/data/transfers_summer_2018_2025.csv"</span>)</span>
<span id="cb799-150"><a href="#cb799-150" aria-hidden="true" tabindex="-1"></a><span class="co"># fwrite(rival_counts_season,      "~/sem3/research_project/rival_analysis/data/rival_transfer_counts_season.csv")</span></span>
<span id="cb799-151"><a href="#cb799-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-152"><a href="#cb799-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-153"><a href="#cb799-153" aria-hidden="true" tabindex="-1"></a><span class="do">## ---------------- Q2: OPTIONS FOR RIVAL TRANSFERS ---------------- ##</span></span>
<span id="cb799-154"><a href="#cb799-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-155"><a href="#cb799-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Rival transfers only</span></span>
<span id="cb799-156"><a href="#cb799-156" aria-hidden="true" tabindex="-1"></a>rival_transfers <span class="ot">&lt;-</span> xf[is_rival <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb799-157"><a href="#cb799-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-158"><a href="#cb799-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Join league-restricted options</span></span>
<span id="cb799-159"><a href="#cb799-159" aria-hidden="true" tabindex="-1"></a>rival_with_options <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-160"><a href="#cb799-160" aria-hidden="true" tabindex="-1"></a>  rival_transfers,</span>
<span id="cb799-161"><a href="#cb799-161" aria-hidden="true" tabindex="-1"></a>  non_rival_pool,</span>
<span id="cb799-162"><a href="#cb799-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"pos_clean"</span>),</span>
<span id="cb799-163"><a href="#cb799-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-164"><a href="#cb799-164" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-165"><a href="#cb799-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-166"><a href="#cb799-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Join global options</span></span>
<span id="cb799-167"><a href="#cb799-167" aria-hidden="true" tabindex="-1"></a>rival_with_options <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-168"><a href="#cb799-168" aria-hidden="true" tabindex="-1"></a>  rival_with_options,</span>
<span id="cb799-169"><a href="#cb799-169" aria-hidden="true" tabindex="-1"></a>  global_non_rival_pool,</span>
<span id="cb799-170"><a href="#cb799-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"season"</span>, <span class="st">"pos_clean"</span>),</span>
<span id="cb799-171"><a href="#cb799-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-172"><a href="#cb799-172" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-173"><a href="#cb799-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-174"><a href="#cb799-174" aria-hidden="true" tabindex="-1"></a>rival_with_options <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb799-175"><a href="#cb799-175" aria-hidden="true" tabindex="-1"></a>  rival_with_options,</span>
<span id="cb799-176"><a href="#cb799-176" aria-hidden="true" tabindex="-1"></a>  total_rival_pool,</span>
<span id="cb799-177"><a href="#cb799-177" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"season"</span>, <span class="st">"pos_clean"</span>),</span>
<span id="cb799-178"><a href="#cb799-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb799-179"><a href="#cb799-179" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb799-180"><a href="#cb799-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-181"><a href="#cb799-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with zeros</span></span>
<span id="cb799-182"><a href="#cb799-182" aria-hidden="true" tabindex="-1"></a>rival_with_options[</span>
<span id="cb799-183"><a href="#cb799-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(non_rival_options), non_rival_options <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>L</span>
<span id="cb799-184"><a href="#cb799-184" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb799-185"><a href="#cb799-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(global_non_rival_options), global_non_rival_options <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>L</span>
<span id="cb799-186"><a href="#cb799-186" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb799-187"><a href="#cb799-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(total_rival_options), total_rival_options <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>L</span>
<span id="cb799-188"><a href="#cb799-188" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-189"><a href="#cb799-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-190"><a href="#cb799-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Final tidy table</span></span>
<span id="cb799-191"><a href="#cb799-191" aria-hidden="true" tabindex="-1"></a>result_q2 <span class="ot">&lt;-</span> rival_with_options[</span>
<span id="cb799-192"><a href="#cb799-192" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb799-193"><a href="#cb799-193" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb799-194"><a href="#cb799-194" aria-hidden="true" tabindex="-1"></a>    country,</span>
<span id="cb799-195"><a href="#cb799-195" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb799-196"><a href="#cb799-196" aria-hidden="true" tabindex="-1"></a>    buyer_clean,</span>
<span id="cb799-197"><a href="#cb799-197" aria-hidden="true" tabindex="-1"></a>    seller_clean,</span>
<span id="cb799-198"><a href="#cb799-198" aria-hidden="true" tabindex="-1"></a>    player_name,</span>
<span id="cb799-199"><a href="#cb799-199" aria-hidden="true" tabindex="-1"></a>    player_position,</span>
<span id="cb799-200"><a href="#cb799-200" aria-hidden="true" tabindex="-1"></a>    non_rival_options,           <span class="co"># league/country restricted</span></span>
<span id="cb799-201"><a href="#cb799-201" aria-hidden="true" tabindex="-1"></a>    global_non_rival_options,     <span class="co"># league-agnostic</span></span>
<span id="cb799-202"><a href="#cb799-202" aria-hidden="true" tabindex="-1"></a>    total_rival_options</span>
<span id="cb799-203"><a href="#cb799-203" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb799-204"><a href="#cb799-204" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb799-205"><a href="#cb799-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-206"><a href="#cb799-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-207"><a href="#cb799-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional save</span></span>
<span id="cb799-208"><a href="#cb799-208" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(result_q2, <span class="st">"~/sem3/research_project/rival_analysis/data/rival_and_non_rival_pool.csv"</span>)</span>
<span id="cb799-209"><a href="#cb799-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-210"><a href="#cb799-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-211"><a href="#cb799-211" aria-hidden="true" tabindex="-1"></a><span class="do">## --------- QUICK GLANCE AT RESULTS --------- ##</span></span>
<span id="cb799-212"><a href="#cb799-212" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Q1: Share of rival transfers per country-season ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Q1: Share of rival transfers per country-season ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb801"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb801-1"><a href="#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rival_counts_team_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     country season buyer_clean total_transfers rival_transfers share_rival
      &lt;char&gt;  &lt;int&gt;      &lt;char&gt;           &lt;int&gt;           &lt;int&gt;       &lt;num&gt;
  1: England   2018    west ham               7               0           0
  2: England   2018     chelsea               3               0           0
  3: England   2018      Wolves               4               0           0
  4: England   2018     everton               3               0           0
  5: England   2018 bournemouth               2               0           0
 ---                                                                       
484:   Spain   2024   barcelona               2               0           0
485:   Spain   2024  sevilla fc               2               0           0
486:   Spain   2024      girona               1               0           0
487:   Spain   2024      getafe               2               2           1
488:   Spain   2024  ca osasuna               1               0           0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb803"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb803-1"><a href="#cb803-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rival_counts_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country, season&gt;
    country season total_transfers rival_transfers share_rival
     &lt;char&gt;  &lt;int&gt;           &lt;int&gt;           &lt;int&gt;       &lt;num&gt;
 1: England   2018              42               1  0.02380952
 2: England   2019              34               6  0.17647059
 3: England   2020              40               7  0.17500000
 4: England   2021              34               4  0.11764706
 5: England   2022              71              13  0.18309859
 6: England   2023              61              10  0.16393443
 7: England   2024              55               7  0.12727273
 8:  France   2018              33               7  0.21212121
 9:  France   2019              44               5  0.11363636
10:  France   2020              38              10  0.26315789
11:  France   2021              27               4  0.14814815
12:  France   2022              51               5  0.09803922
13:  France   2023              46               2  0.04347826
14:  France   2024              35               3  0.08571429
15: Germany   2018              31               3  0.09677419
16: Germany   2019              47              12  0.25531915
17: Germany   2020              29               5  0.17241379
18: Germany   2021              28               5  0.17857143
19: Germany   2022              44               7  0.15909091
20: Germany   2023              50              10  0.20000000
21: Germany   2024              42               1  0.02380952
22:   Italy   2018              50              13  0.26000000
23:   Italy   2019              60              16  0.26666667
24:   Italy   2020              44              10  0.22727273
25:   Italy   2021              44              14  0.31818182
26:   Italy   2022              48              13  0.27083333
27:   Italy   2023              46               5  0.10869565
28:   Italy   2024              51               7  0.13725490
29:   Spain   2018              55              15  0.27272727
30:   Spain   2019              55              19  0.34545455
31:   Spain   2020              27               9  0.33333333
32:   Spain   2021              37               9  0.24324324
33:   Spain   2022              49              11  0.22448980
34:   Spain   2023              51              12  0.23529412
35:   Spain   2024              42               5  0.11904762
    country season total_transfers rival_transfers share_rival</code></pre>
</div>
<div class="sourceCode cell-code" id="cb805"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb805-1"><a href="#cb805-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Q2: Example rival transfers &amp; their non-rival options ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Q2: Example rival transfers &amp; their non-rival options ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb807"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb807-1"><a href="#cb807-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result_q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country, season&gt;
     country season    buyer_clean  seller_clean       player_name
      &lt;char&gt;  &lt;int&gt;         &lt;char&gt;        &lt;char&gt;            &lt;char&gt;
  1: England   2018 crystal palace      west ham  Cheikhou Kouyaté
  2: England   2019 crystal palace       everton    James McCarthy
  3: England   2019    aston villa   bournemouth      Tyrone Mings
  4: England   2019        arsenal       chelsea        David Luiz
  5: England   2019        man utd     leicester     Harry Maguire
 ---                                                              
281:   Spain   2024     villarreal    real betis       Ayoze Pérez
282:   Spain   2024       atlético    villarreal Alexander Sørloth
283:   Spain   2024         getafe real sociedad        Diego Rico
284:   Spain   2024         getafe real sociedad         Álex Sola
285:   Spain   2024   rcd mallorca real sociedad    Robert Navarro
        player_position non_rival_options global_non_rival_options
                 &lt;char&gt;             &lt;int&gt;                    &lt;int&gt;
  1: Defensive Midfield                 0                       18
  2:   Central Midfield                 2                       26
  3:        Centre-Back                 2                       28
  4:        Centre-Back                 2                       28
  5:        Centre-Back                 2                       28
 ---                                                              
281:     Centre-Forward                 2                       34
282:     Centre-Forward                 2                       34
283:          Left-Back                 3                       17
284:       Right Winger                 1                       16
285:       Right Winger                 1                       16
     total_rival_options
                   &lt;int&gt;
  1:                   1
  2:                   1
  3:                   3
  4:                   3
  5:                   3
 ---                    
281:                   2
282:                   2
283:                   1
284:                   2
285:                   2</code></pre>
</div>
</div>
</section>
<section id="transfer-impact" class="level2">
<h2 class="anchored" data-anchor-id="transfer-impact">Transfer Impact</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb809"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb809-1"><a href="#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== PATHS ===================== ##</span></span>
<span id="cb809-2"><a href="#cb809-2" aria-hidden="true" tabindex="-1"></a>league_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/league_table.csv"</span></span>
<span id="cb809-3"><a href="#cb809-3" aria-hidden="true" tabindex="-1"></a>xf_path     <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/top5_league_transfers_clean.csv"</span></span>
<span id="cb809-4"><a href="#cb809-4" aria-hidden="true" tabindex="-1"></a>rivals_path <span class="ot">&lt;-</span> <span class="st">"~/sem3/research_project/rival_analysis/data/season_rivalries_elo_combined.csv"</span></span>
<span id="cb809-5"><a href="#cb809-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-6"><a href="#cb809-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 1. LEAGUE PERFORMANCE ===================== ##</span></span>
<span id="cb809-7"><a href="#cb809-7" aria-hidden="true" tabindex="-1"></a>league <span class="ot">&lt;-</span> <span class="fu">fread</span>(league_path)</span>
<span id="cb809-8"><a href="#cb809-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-9"><a href="#cb809-9" aria-hidden="true" tabindex="-1"></a><span class="co"># clean team names</span></span>
<span id="cb809-10"><a href="#cb809-10" aria-hidden="true" tabindex="-1"></a>league[, team_clean <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(<span class="fu">str_squish</span>(squad))]</span>
<span id="cb809-11"><a href="#cb809-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-12"><a href="#cb809-12" aria-hidden="true" tabindex="-1"></a><span class="co"># season is ALREADY correct (season start year)</span></span>
<span id="cb809-13"><a href="#cb809-13" aria-hidden="true" tabindex="-1"></a>league[, season_start <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(season)]</span>
<span id="cb809-14"><a href="#cb809-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-15"><a href="#cb809-15" aria-hidden="true" tabindex="-1"></a><span class="co"># points per match</span></span>
<span id="cb809-16"><a href="#cb809-16" aria-hidden="true" tabindex="-1"></a>league[, ppm <span class="sc">:</span><span class="er">=</span> pts <span class="sc">/</span> p]</span>
<span id="cb809-17"><a href="#cb809-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-18"><a href="#cb809-18" aria-hidden="true" tabindex="-1"></a><span class="co"># final table per team-season</span></span>
<span id="cb809-19"><a href="#cb809-19" aria-hidden="true" tabindex="-1"></a>league_final <span class="ot">&lt;-</span> league[</span>
<span id="cb809-20"><a href="#cb809-20" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb809-21"><a href="#cb809-21" aria-hidden="true" tabindex="-1"></a>  .SD[<span class="fu">which.max</span>(matchday)],</span>
<span id="cb809-22"><a href="#cb809-22" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season_start, team_clean)</span>
<span id="cb809-23"><a href="#cb809-23" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb809-24"><a href="#cb809-24" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb809-25"><a href="#cb809-25" aria-hidden="true" tabindex="-1"></a>  .(country, season_start, team_clean, ppm)</span>
<span id="cb809-26"><a href="#cb809-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb809-27"><a href="#cb809-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-28"><a href="#cb809-28" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 2. TRANSFERS ===================== ##</span></span>
<span id="cb809-29"><a href="#cb809-29" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">fread</span>(xf_path)</span>
<span id="cb809-30"><a href="#cb809-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-31"><a href="#cb809-31" aria-hidden="true" tabindex="-1"></a><span class="co"># restrict to relevant transfers</span></span>
<span id="cb809-32"><a href="#cb809-32" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> xf[</span>
<span id="cb809-33"><a href="#cb809-33" aria-hidden="true" tabindex="-1"></a>  window <span class="sc">==</span> <span class="st">"Summer"</span> <span class="sc">&amp;</span></span>
<span id="cb809-34"><a href="#cb809-34" aria-hidden="true" tabindex="-1"></a>  transfer_type <span class="sc">==</span> <span class="st">"Arrivals"</span> <span class="sc">&amp;</span></span>
<span id="cb809-35"><a href="#cb809-35" aria-hidden="true" tabindex="-1"></a>  (is_loan <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">|</span> <span class="fu">is.na</span>(is_loan))</span>
<span id="cb809-36"><a href="#cb809-36" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb809-37"><a href="#cb809-37" aria-hidden="true" tabindex="-1"></a>xf[, season       <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(season)]</span>
<span id="cb809-38"><a href="#cb809-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-39"><a href="#cb809-39" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 4. ATTACH PERFORMANCE ===================== ##</span></span>
<span id="cb809-40"><a href="#cb809-40" aria-hidden="true" tabindex="-1"></a><span class="co"># AFTER season (same season)</span></span>
<span id="cb809-41"><a href="#cb809-41" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb809-42"><a href="#cb809-42" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb809-43"><a href="#cb809-43" aria-hidden="true" tabindex="-1"></a>  league_final,</span>
<span id="cb809-44"><a href="#cb809-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"buyer_clean"</span>, <span class="st">"season"</span>),</span>
<span id="cb809-45"><a href="#cb809-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"team_clean"</span>, <span class="st">"season_start"</span>),</span>
<span id="cb809-46"><a href="#cb809-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb809-47"><a href="#cb809-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb809-48"><a href="#cb809-48" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(xf, <span class="st">"ppm"</span>, <span class="st">"ppm_after"</span>)</span>
<span id="cb809-49"><a href="#cb809-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-50"><a href="#cb809-50" aria-hidden="true" tabindex="-1"></a><span class="co"># BEFORE season (season - 1)</span></span>
<span id="cb809-51"><a href="#cb809-51" aria-hidden="true" tabindex="-1"></a>xf[, season_before <span class="sc">:</span><span class="er">=</span> season <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb809-52"><a href="#cb809-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-53"><a href="#cb809-53" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb809-54"><a href="#cb809-54" aria-hidden="true" tabindex="-1"></a>  xf,</span>
<span id="cb809-55"><a href="#cb809-55" aria-hidden="true" tabindex="-1"></a>  league_final,</span>
<span id="cb809-56"><a href="#cb809-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"buyer_clean"</span>, <span class="st">"season_before"</span>),</span>
<span id="cb809-57"><a href="#cb809-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"team_clean"</span>, <span class="st">"season_start"</span>),</span>
<span id="cb809-58"><a href="#cb809-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb809-59"><a href="#cb809-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb809-60"><a href="#cb809-60" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(xf, <span class="st">"ppm"</span>, <span class="st">"ppm_before"</span>)</span>
<span id="cb809-61"><a href="#cb809-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-62"><a href="#cb809-62" aria-hidden="true" tabindex="-1"></a><span class="co"># impact</span></span>
<span id="cb809-63"><a href="#cb809-63" aria-hidden="true" tabindex="-1"></a>xf[, delta_ppm <span class="sc">:</span><span class="er">=</span> ppm_after <span class="sc">-</span> ppm_before]</span>
<span id="cb809-64"><a href="#cb809-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-65"><a href="#cb809-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 5. IMPACT DATASET ===================== ##</span></span>
<span id="cb809-66"><a href="#cb809-66" aria-hidden="true" tabindex="-1"></a>impact_all <span class="ot">&lt;-</span> xf[</span>
<span id="cb809-67"><a href="#cb809-67" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(delta_ppm),</span>
<span id="cb809-68"><a href="#cb809-68" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb809-69"><a href="#cb809-69" aria-hidden="true" tabindex="-1"></a>    country,</span>
<span id="cb809-70"><a href="#cb809-70" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb809-71"><a href="#cb809-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">buyer_team =</span> team_name,</span>
<span id="cb809-72"><a href="#cb809-72" aria-hidden="true" tabindex="-1"></a>    player_name,</span>
<span id="cb809-73"><a href="#cb809-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> player_position,</span>
<span id="cb809-74"><a href="#cb809-74" aria-hidden="true" tabindex="-1"></a>    is_rival,</span>
<span id="cb809-75"><a href="#cb809-75" aria-hidden="true" tabindex="-1"></a>    ppm_before,</span>
<span id="cb809-76"><a href="#cb809-76" aria-hidden="true" tabindex="-1"></a>    ppm_after,</span>
<span id="cb809-77"><a href="#cb809-77" aria-hidden="true" tabindex="-1"></a>    delta_ppm</span>
<span id="cb809-78"><a href="#cb809-78" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb809-79"><a href="#cb809-79" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb809-80"><a href="#cb809-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-81"><a href="#cb809-81" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== 6. RIVAL VS NON-RIVAL ===================== ##</span></span>
<span id="cb809-82"><a href="#cb809-82" aria-hidden="true" tabindex="-1"></a>impact_summary <span class="ot">&lt;-</span> impact_all[</span>
<span id="cb809-83"><a href="#cb809-83" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb809-84"><a href="#cb809-84" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb809-85"><a href="#cb809-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delta_ppm    =</span> <span class="fu">mean</span>(delta_ppm),</span>
<span id="cb809-86"><a href="#cb809-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_delta_ppm =</span> <span class="fu">median</span>(delta_ppm),</span>
<span id="cb809-87"><a href="#cb809-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">n                =</span> .N</span>
<span id="cb809-88"><a href="#cb809-88" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb809-89"><a href="#cb809-89" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(is_rival)</span>
<span id="cb809-90"><a href="#cb809-90" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb809-91"><a href="#cb809-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-92"><a href="#cb809-92" aria-hidden="true" tabindex="-1"></a>impact_by_season <span class="ot">&lt;-</span> impact_all[</span>
<span id="cb809-93"><a href="#cb809-93" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb809-94"><a href="#cb809-94" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb809-95"><a href="#cb809-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delta_ppm =</span> <span class="fu">mean</span>(delta_ppm),</span>
<span id="cb809-96"><a href="#cb809-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> .N</span>
<span id="cb809-97"><a href="#cb809-97" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb809-98"><a href="#cb809-98" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, season, is_rival)</span>
<span id="cb809-99"><a href="#cb809-99" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb809-100"><a href="#cb809-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-101"><a href="#cb809-101" aria-hidden="true" tabindex="-1"></a><span class="do">## ===================== OUTPUT ===================== ##</span></span>
<span id="cb809-102"><a href="#cb809-102" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Rival vs Non-Rival Impact (All Seasons) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Rival vs Non-Rival Impact (All Seasons) ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb811"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb811-1"><a href="#cb811-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(impact_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   is_rival avg_delta_ppm median_delta_ppm     n
     &lt;lgcl&gt;         &lt;num&gt;            &lt;num&gt; &lt;int&gt;
1:    FALSE   -0.01368732       0.00000000   854
2:     TRUE   -0.03724101      -0.02631579   251</code></pre>
</div>
<div class="sourceCode cell-code" id="cb813"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb813-1"><a href="#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Rival vs Non-Rival Impact by Season ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Rival vs Non-Rival Impact by Season ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb815"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb815-1"><a href="#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(impact_by_season[<span class="fu">order</span>(season)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country season is_rival avg_delta_ppm     n
     &lt;char&gt;  &lt;int&gt;   &lt;lgcl&gt;         &lt;num&gt; &lt;int&gt;
 1: England   2018    FALSE   0.171992481    28
 2: England   2018     TRUE   0.131578947     1
 3:  France   2018     TRUE   0.056390977     7
 4:  France   2018    FALSE   0.042763158     8
 5: Germany   2018    FALSE   0.156346749    19
 6: Germany   2018     TRUE   0.117647059     3
 7:   Italy   2018    FALSE  -0.053429027    33
 8:   Italy   2018     TRUE  -0.111336032    13
 9:   Spain   2018    FALSE  -0.158717105    32
10:   Spain   2018     TRUE  -0.070175439    15
11: England   2019     TRUE  -0.136842105     5
12: England   2019    FALSE  -0.202216066    19
13:  France   2019    FALSE   0.131481481    10
14:  France   2019     TRUE   0.306042885     4
15: Germany   2019    FALSE  -0.033613445    14
16: Germany   2019     TRUE   0.003267974     9
17:   Italy   2019     TRUE  -0.114035088    12
18:   Italy   2019    FALSE   0.058479532    36
19:   Spain   2019    FALSE   0.035964912    30
20:   Spain   2019     TRUE  -0.068421053    15
21: England   2020    FALSE   0.045454545    22
22: England   2020     TRUE  -0.042105263     5
23:  France   2020     TRUE  -0.165692008     8
24:  France   2020    FALSE  -0.172514620    10
25: Germany   2020     TRUE   0.029411765     3
26: Germany   2020    FALSE  -0.011764706    20
27:   Italy   2020    FALSE   0.068058076    29
28:   Italy   2020     TRUE  -0.097368421    10
29:   Spain   2020    FALSE   0.014035088    15
30:   Spain   2020     TRUE   0.065789474     8
31: England   2021    FALSE  -0.062753036    26
32: England   2021     TRUE  -0.440789474     4
33:  France   2021    FALSE   0.236842105     7
34:  France   2021     TRUE   0.065789474     4
35: Germany   2021    FALSE  -0.018907563    14
36: Germany   2021     TRUE  -0.141176471     5
37:   Italy   2021    FALSE  -0.081578947    30
38:   Italy   2021     TRUE  -0.030075188    14
39:   Spain   2021    FALSE  -0.042334096    23
40:   Spain   2021     TRUE  -0.021052632     5
41: England   2022     TRUE  -0.059210526     8
42: England   2022    FALSE  -0.125160462    41
43:  France   2022    FALSE  -0.244019139    11
44:  France   2022     TRUE   0.142105263     5
45: Germany   2022    FALSE  -0.013235294    20
46: Germany   2022     TRUE   0.004201681     7
47:   Italy   2022    FALSE  -0.070850202    26
48:   Italy   2022     TRUE  -0.153846154    13
49:   Spain   2022    FALSE   0.085139319    34
50:   Spain   2022     TRUE   0.002631579    10
51: England   2023    FALSE   0.103289474    40
52: England   2023     TRUE  -0.011695906     9
53:  France   2023    FALSE  -0.243808050    12
54:  France   2023     TRUE   0.636222910     2
55: Germany   2023    FALSE  -0.144796380    26
56: Germany   2023     TRUE   0.035947712     9
57:   Italy   2023    FALSE  -0.119433198    39
58:   Italy   2023     TRUE  -0.125000000     4
59:   Spain   2023    FALSE   0.044117647    34
60:   Spain   2023     TRUE  -0.122807018    12
61: England   2024    FALSE   0.015911873    43
62: England   2024     TRUE   0.120300752     7
63:  France   2024    FALSE   0.209558824     8
64:  France   2024     TRUE  -0.039215686     3
65: Germany   2024    FALSE  -0.037037037    27
66: Germany   2024     TRUE  -0.676470588     1
67:   Italy   2024    FALSE  -0.021804511    35
68:   Italy   2024     TRUE   0.043859649     6
69:   Spain   2024    FALSE   0.043062201    33
70:   Spain   2024     TRUE   0.121052632     5
    country season is_rival avg_delta_ppm     n</code></pre>
</div>
<div class="sourceCode cell-code" id="cb817"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(impact_by_season, <span class="st">"~/sem3/research_project/rival_analysis/data/transfer_impact.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb818"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb818-1"><a href="#cb818-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many observations survive?</span></span>
<span id="cb818-2"><a href="#cb818-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(xf<span class="sc">$</span>delta_ppm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
 1105   436 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb820"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb820-1"><a href="#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="co"># England example</span></span>
<span id="cb820-2"><a href="#cb820-2" aria-hidden="true" tabindex="-1"></a>impact_all[country <span class="sc">==</span> <span class="st">"England"</span>, .N, by <span class="ot">=</span> .(season, is_rival)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    season is_rival     N
     &lt;int&gt;   &lt;lgcl&gt; &lt;int&gt;
 1:   2018    FALSE    28
 2:   2019     TRUE     5
 3:   2019    FALSE    19
 4:   2020    FALSE    22
 5:   2021    FALSE    26
 6:   2022     TRUE     8
 7:   2023    FALSE    40
 8:   2024    FALSE    43
 9:   2020     TRUE     5
10:   2021     TRUE     4
11:   2022    FALSE    41
12:   2024     TRUE     7
13:   2023     TRUE     9
14:   2018     TRUE     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb822"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb822-1"><a href="#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick spot check</span></span>
<span id="cb822-2"><a href="#cb822-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(impact_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   country season buyer_team          player_name           position is_rival
    &lt;char&gt;  &lt;int&gt;     &lt;char&gt;               &lt;char&gt;             &lt;char&gt;   &lt;lgcl&gt;
1: England   2018 Arsenal FC             Sokratis        Centre-Back    FALSE
2: England   2018 Arsenal FC Stephan Lichtsteiner         Right-Back    FALSE
3: England   2018 Arsenal FC           Bernd Leno         Goalkeeper    FALSE
4: England   2018 Arsenal FC       Lucas Torreira Defensive Midfield    FALSE
5: England   2019 Arsenal FC           David Luiz        Centre-Back     TRUE
6: England   2019 Arsenal FC         Nicolas Pépé       Right Winger    FALSE
   ppm_before ppm_after  delta_ppm
        &lt;num&gt;     &lt;num&gt;      &lt;num&gt;
1:   1.657895  1.842105  0.1842105
2:   1.657895  1.842105  0.1842105
3:   1.657895  1.842105  0.1842105
4:   1.657895  1.842105  0.1842105
5:   1.842105  1.473684 -0.3684211
6:   1.842105  1.473684 -0.3684211</code></pre>
</div>
</div>
</section>
<section id="rival-preference" class="level2">
<h2 class="anchored" data-anchor-id="rival-preference">Rival preference</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb824"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb824-1"><a href="#cb824-1" aria-hidden="true" tabindex="-1"></a>team_rival_profile <span class="ot">&lt;-</span> xf[</span>
<span id="cb824-2"><a href="#cb824-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb824-3"><a href="#cb824-3" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb824-4"><a href="#cb824-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_transfers =</span> .N,</span>
<span id="cb824-5"><a href="#cb824-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_transfers =</span> <span class="fu">sum</span>(is_rival),</span>
<span id="cb824-6"><a href="#cb824-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_share     =</span> <span class="fu">mean</span>(is_rival)</span>
<span id="cb824-7"><a href="#cb824-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb824-8"><a href="#cb824-8" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, buyer_clean)</span>
<span id="cb824-9"><a href="#cb824-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb824-10"><a href="#cb824-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-11"><a href="#cb824-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimum activity filter (important)</span></span>
<span id="cb824-12"><a href="#cb824-12" aria-hidden="true" tabindex="-1"></a>team_rival_profile <span class="ot">&lt;-</span> team_rival_profile[total_transfers <span class="sc">&gt;=</span> <span class="dv">10</span>]</span>
<span id="cb824-13"><a href="#cb824-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-14"><a href="#cb824-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Top "competitive" teams</span></span>
<span id="cb824-15"><a href="#cb824-15" aria-hidden="true" tabindex="-1"></a>team_rival_profile[<span class="fu">order</span>(<span class="sc">-</span>rival_share)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country     buyer_clean total_transfers rival_transfers rival_share
     &lt;char&gt;          &lt;char&gt;           &lt;int&gt;           &lt;int&gt;       &lt;num&gt;
 1:   Spain      ca osasuna              16              12  0.75000000
 2:   Italy      fiorentina              14               7  0.50000000
 3:  France   stade rennais              24              11  0.45833333
 4: Germany       1.fc köln              11               5  0.45454545
 5:   Spain         levante              11               5  0.45454545
 6:   Spain          getafe              18               8  0.44444444
 7:   Italy   hellas verona              21               9  0.42857143
 8:  France      angers sco              19               8  0.42105263
 9: Germany        freiburg              15               6  0.40000000
10:   Spain  rayo vallecano              13               5  0.38461538
11: England          fulham              18               6  0.33333333
12: England       newcastle              15               5  0.33333333
13:   Italy          napoli              18               6  0.33333333
14:   Spain        espanyol              12               4  0.33333333
15:   Italy           lazio              22               7  0.31818182
16: Germany    union berlin              23               7  0.30434783
17:   Italy            roma              34              10  0.29411765
18:   Spain    rcd mallorca              17               5  0.29411765
19:   Spain      real betis              24               7  0.29166667
20: Germany       stuttgart              18               5  0.27777778
21: Germany        dortmund              26               7  0.26923077
22:   Spain      villarreal              26               7  0.26923077
23:  France  stade brestois              19               5  0.26315789
24:   Italy           inter              23               6  0.26086957
25:   Spain          girona              12               3  0.25000000
26:   Spain        valencia              21               5  0.23809524
27: England         man utd              17               4  0.23529412
28:   Italy        atalanta              17               4  0.23529412
29:   Italy        sassuolo              30               7  0.23333333
30: England  crystal palace              18               4  0.22222222
31:   Spain   celta de vigo              14               3  0.21428571
32: Germany        augsburg              24               5  0.20833333
33: England   nott'm forest              20               4  0.20000000
34:  France   r. strasbourg              16               3  0.18750000
35:  France       fc nantes              11               2  0.18181818
36:   Italy          torino              22               4  0.18181818
37:   Spain        atlético              22               4  0.18181818
38:   Italy         bologna              17               3  0.17647059
39: England         chelsea              31               5  0.16129032
40: England     aston villa              25               4  0.16000000
41:   Italy        ac milan              20               3  0.15000000
42:   Italy        juventus              20               3  0.15000000
43:   Italy         udinese              20               3  0.15000000
44: Germany         leipzig              21               3  0.14285714
45:   Spain      sevilla fc              28               4  0.14285714
46: England         arsenal              22               3  0.13636364
47: England           leeds              15               2  0.13333333
48:   Spain   real sociedad              15               2  0.13333333
49: England        west ham              24               3  0.12500000
50:   Spain       barcelona              24               3  0.12500000
51:   Italy           genoa              19               2  0.10526316
52: England     bournemouth              10               1  0.10000000
53:   Italy        cagliari              10               1  0.10000000
54: England         everton              21               2  0.09523810
55: Germany   bayern munich              21               2  0.09523810
56: Germany   werder bremen              13               1  0.07692308
57: Germany       wolfsburg              14               1  0.07142857
58: England       tottenham              20               1  0.05000000
59: England        Brighton              16               0  0.00000000
60: England          Wolves              21               0  0.00000000
61: England       liverpool              14               0  0.00000000
62: England        man city              13               0  0.00000000
63:  France            Lens              13               0  0.00000000
64:  France           Lille              18               0  0.00000000
65:  France            Lyon              24               0  0.00000000
66:  France       Marseille              21               0  0.00000000
67:  France          Monaco              26               0  0.00000000
68:  France            Nice              24               0  0.00000000
69:  France             PSG              31               0  0.00000000
70: Germany       Frankfurt              22               0  0.00000000
71: Germany      Hoffenheim              12               0  0.00000000
72: Germany      Leverkusen              15               0  0.00000000
73: Germany           Mainz              17               0  0.00000000
74: Germany Mönchengladbach              13               0  0.00000000
75:   Italy           Parma              14               0  0.00000000
76:   Spain          Alavés              16               0  0.00000000
77:   Spain     real madrid              15               0  0.00000000
    country     buyer_clean total_transfers rival_transfers rival_share</code></pre>
</div>
<div class="sourceCode cell-code" id="cb826"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(team_rival_profile, <span class="st">"~/sem3/research_project/rival_analysis/data/rival_transfer_preference.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="weighted-analysis" class="level2">
<h2 class="anchored" data-anchor-id="weighted-analysis">Weighted Analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb827"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb827-1"><a href="#cb827-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"~/sem3/research_project/rival_analysis/data/rival_and_non_rival_pool.csv"</span>)</span>
<span id="cb827-2"><a href="#cb827-2" aria-hidden="true" tabindex="-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     country season    buyer_clean  seller_clean       player_name
      &lt;char&gt;  &lt;int&gt;         &lt;char&gt;        &lt;char&gt;            &lt;char&gt;
  1: England   2018 crystal palace      west ham  Cheikhou Kouyaté
  2: England   2019 crystal palace       everton    James McCarthy
  3: England   2019    aston villa   bournemouth      Tyrone Mings
  4: England   2019        arsenal       chelsea        David Luiz
  5: England   2019        man utd     leicester     Harry Maguire
 ---                                                              
281:   Spain   2024     villarreal    real betis       Ayoze Pérez
282:   Spain   2024       atlético    villarreal Alexander Sørloth
283:   Spain   2024         getafe real sociedad        Diego Rico
284:   Spain   2024         getafe real sociedad         Álex Sola
285:   Spain   2024   rcd mallorca real sociedad    Robert Navarro
        player_position non_rival_options global_non_rival_options
                 &lt;char&gt;             &lt;int&gt;                    &lt;int&gt;
  1: Defensive Midfield                 0                       18
  2:   Central Midfield                 2                       26
  3:        Centre-Back                 2                       28
  4:        Centre-Back                 2                       28
  5:        Centre-Back                 2                       28
 ---                                                              
281:     Centre-Forward                 2                       34
282:     Centre-Forward                 2                       34
283:          Left-Back                 3                       17
284:       Right Winger                 1                       16
285:       Right Winger                 1                       16
     total_rival_options
                   &lt;int&gt;
  1:                   1
  2:                   1
  3:                   3
  4:                   3
  5:                   3
 ---                    
281:                   2
282:                   2
283:                   1
284:                   2
285:                   2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb829"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb829-1"><a href="#cb829-1" aria-hidden="true" tabindex="-1"></a>dt[, league_lvl_weight <span class="sc">:</span><span class="er">=</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> non_rival_options)]</span>
<span id="cb829-2"><a href="#cb829-2" aria-hidden="true" tabindex="-1"></a>dt[, global_weight <span class="sc">:</span><span class="er">=</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> global_non_rival_options)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb830"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a>dt[<span class="fu">order</span>(<span class="sc">-</span>league_lvl_weight)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     country season    buyer_clean  seller_clean       player_name
      &lt;char&gt;  &lt;int&gt;         &lt;char&gt;        &lt;char&gt;            &lt;char&gt;
  1:   Italy   2018          inter         lazio    Stefan de Vrij
  2:   Italy   2020         torino     sampdoria     Karol Linetty
  3:   Italy   2020     fiorentina      sassuolo     Alfred Duncan
  4:   Italy   2024         torino       udinese       Adam Masina
  5: Germany   2022      1.fc köln    hoffenheim    Sargis Adamyan
 ---                                                              
281:   Spain   2022 rayo vallecano      cádiz cf     Salvi Sánchez
282:   Spain   2022  real sociedad   real madrid     Takefusa Kubo
283:   Spain   2022     sevilla fc real sociedad     Adnan Januzaj
284:   Spain   2022         girona      valencia      Manu Vallejo
285:   Spain   2023       atlético     barcelona Antoine Griezmann
      player_position non_rival_options global_non_rival_options
               &lt;char&gt;             &lt;int&gt;                    &lt;int&gt;
  1:      Centre-Back                 6                       32
  2: Central Midfield                 5                       16
  3: Central Midfield                 5                       16
  4:      Centre-Back                 5                       45
  5:   Centre-Forward                 4                       40
 ---                                                            
281:     Right Winger                 0                        8
282:     Right Winger                 0                        8
283:     Right Winger                 0                        8
284:   Second Striker                 0                        0
285:   Second Striker                 0                        3
     total_rival_options league_lvl_weight global_weight
                   &lt;int&gt;             &lt;num&gt;         &lt;num&gt;
  1:                   1          1.945910      3.496508
  2:                   2          1.791759      2.833213
  3:                   2          1.791759      2.833213
  4:                   1          1.791759      3.828641
  5:                   1          1.609438      3.713572
 ---                                                    
281:                   3          0.000000      2.197225
282:                   3          0.000000      2.197225
283:                   3          0.000000      2.197225
284:                   1          0.000000      0.000000
285:                   1          0.000000      1.386294</code></pre>
</div>
</div>
<section id="rival-preference-based-on-weight" class="level3">
<h3 class="anchored" data-anchor-id="rival-preference-based-on-weight">Rival preference based on weight</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb832"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb832-1"><a href="#cb832-1" aria-hidden="true" tabindex="-1"></a>xf_all <span class="ot">&lt;-</span> xf[</span>
<span id="cb832-2"><a href="#cb832-2" aria-hidden="true" tabindex="-1"></a>  window <span class="sc">==</span> <span class="st">"Summer"</span> <span class="sc">&amp;</span></span>
<span id="cb832-3"><a href="#cb832-3" aria-hidden="true" tabindex="-1"></a>  transfer_type <span class="sc">==</span> <span class="st">"Arrivals"</span> <span class="sc">&amp;</span></span>
<span id="cb832-4"><a href="#cb832-4" aria-hidden="true" tabindex="-1"></a>  (is_loan <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">|</span> <span class="fu">is.na</span>(is_loan)),</span>
<span id="cb832-5"><a href="#cb832-5" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb832-6"><a href="#cb832-6" aria-hidden="true" tabindex="-1"></a>    country,</span>
<span id="cb832-7"><a href="#cb832-7" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb832-8"><a href="#cb832-8" aria-hidden="true" tabindex="-1"></a>    buyer_clean,</span>
<span id="cb832-9"><a href="#cb832-9" aria-hidden="true" tabindex="-1"></a>    seller_clean,</span>
<span id="cb832-10"><a href="#cb832-10" aria-hidden="true" tabindex="-1"></a>    player_name,</span>
<span id="cb832-11"><a href="#cb832-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> player_position,</span>
<span id="cb832-12"><a href="#cb832-12" aria-hidden="true" tabindex="-1"></a>    is_rival</span>
<span id="cb832-13"><a href="#cb832-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb832-14"><a href="#cb832-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb832-15"><a href="#cb832-15" aria-hidden="true" tabindex="-1"></a>dt_rival <span class="ot">&lt;-</span> dt[</span>
<span id="cb832-16"><a href="#cb832-16" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb832-17"><a href="#cb832-17" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb832-18"><a href="#cb832-18" aria-hidden="true" tabindex="-1"></a>    country,</span>
<span id="cb832-19"><a href="#cb832-19" aria-hidden="true" tabindex="-1"></a>    season,</span>
<span id="cb832-20"><a href="#cb832-20" aria-hidden="true" tabindex="-1"></a>    buyer_clean,</span>
<span id="cb832-21"><a href="#cb832-21" aria-hidden="true" tabindex="-1"></a>    seller_clean,</span>
<span id="cb832-22"><a href="#cb832-22" aria-hidden="true" tabindex="-1"></a>    player_name,</span>
<span id="cb832-23"><a href="#cb832-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> player_position,</span>
<span id="cb832-24"><a href="#cb832-24" aria-hidden="true" tabindex="-1"></a>    league_lvl_weight,</span>
<span id="cb832-25"><a href="#cb832-25" aria-hidden="true" tabindex="-1"></a>    global_weight</span>
<span id="cb832-26"><a href="#cb832-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb832-27"><a href="#cb832-27" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb832-28"><a href="#cb832-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-29"><a href="#cb832-29" aria-hidden="true" tabindex="-1"></a>xf_combined <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb832-30"><a href="#cb832-30" aria-hidden="true" tabindex="-1"></a>  xf_all,</span>
<span id="cb832-31"><a href="#cb832-31" aria-hidden="true" tabindex="-1"></a>  dt_rival,</span>
<span id="cb832-32"><a href="#cb832-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(</span>
<span id="cb832-33"><a href="#cb832-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"country"</span>,</span>
<span id="cb832-34"><a href="#cb832-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"season"</span>,</span>
<span id="cb832-35"><a href="#cb832-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buyer_clean"</span>,</span>
<span id="cb832-36"><a href="#cb832-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"seller_clean"</span>,</span>
<span id="cb832-37"><a href="#cb832-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"player_name"</span>,</span>
<span id="cb832-38"><a href="#cb832-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"position"</span></span>
<span id="cb832-39"><a href="#cb832-39" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb832-40"><a href="#cb832-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb832-41"><a href="#cb832-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb832-42"><a href="#cb832-42" aria-hidden="true" tabindex="-1"></a>xf_combined[, is_rival <span class="sc">:</span><span class="er">=</span> <span class="sc">!</span><span class="fu">is.na</span>(league_lvl_weight)]</span>
<span id="cb832-43"><a href="#cb832-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-44"><a href="#cb832-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign weights = 1 for non-rival transfers</span></span>
<span id="cb832-45"><a href="#cb832-45" aria-hidden="true" tabindex="-1"></a>xf_combined[<span class="fu">is.na</span>(league_lvl_weight), league_lvl_weight <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span>]</span>
<span id="cb832-46"><a href="#cb832-46" aria-hidden="true" tabindex="-1"></a>xf_combined[<span class="fu">is.na</span>(global_weight),     global_weight     <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span>]</span>
<span id="cb832-47"><a href="#cb832-47" aria-hidden="true" tabindex="-1"></a>xf_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country, season, buyer_clean, seller_clean, player_name, position&gt;
      country season buyer_clean  seller_clean    player_name
       &lt;char&gt;  &lt;int&gt;      &lt;char&gt;        &lt;char&gt;         &lt;char&gt;
   1: England   2018    Brighton        fulham   David Button
   2: England   2018    Brighton       leipzig       Bernardo
   3: England   2018    Brighton         lille  Yves Bissouma
   4: England   2018    Brighton         mainz   Leon Balogun
   5: England   2018    Brighton      valencia Martín Montoya
  ---                                                        
1537:   Spain   2024  villarreal       man utd Willy Kambwala
1538:   Spain   2024  villarreal     marseille     Pape Gueye
1539:   Spain   2024  villarreal    real betis    Ayoze Pérez
1540:   Spain   2024  villarreal      toulouse    Logan Costa
1541:   Spain   2024  villarreal ud las palmas  Sergi Cardona
                position is_rival league_lvl_weight global_weight
                  &lt;char&gt;   &lt;lgcl&gt;             &lt;num&gt;         &lt;num&gt;
   1:         Goalkeeper    FALSE          1.000000      1.000000
   2:        Centre-Back    FALSE          1.000000      1.000000
   3: Defensive Midfield    FALSE          1.000000      1.000000
   4:        Centre-Back    FALSE          1.000000      1.000000
   5:         Right-Back    FALSE          1.000000      1.000000
  ---                                                            
1537:        Centre-Back    FALSE          1.000000      1.000000
1538: Defensive Midfield    FALSE          1.000000      1.000000
1539:     Centre-Forward     TRUE          1.098612      3.555348
1540:        Centre-Back    FALSE          1.000000      1.000000
1541:          Left-Back    FALSE          1.000000      1.000000</code></pre>
</div>
</div>
<p>League-level</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb834"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a>club_pref_league <span class="ot">&lt;-</span> xf_combined[</span>
<span id="cb834-2"><a href="#cb834-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb834-3"><a href="#cb834-3" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb834-4"><a href="#cb834-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_transfers =</span> .N,</span>
<span id="cb834-5"><a href="#cb834-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_transfers =</span> <span class="fu">sum</span>(is_rival),</span>
<span id="cb834-6"><a href="#cb834-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">league_weighted_rival =</span> <span class="fu">sum</span>(league_lvl_weight <span class="sc">*</span> is_rival),</span>
<span id="cb834-7"><a href="#cb834-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_league_weight =</span> <span class="fu">mean</span>(league_lvl_weight)</span>
<span id="cb834-8"><a href="#cb834-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb834-9"><a href="#cb834-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, buyer_clean)</span>
<span id="cb834-10"><a href="#cb834-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb834-11"><a href="#cb834-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-12"><a href="#cb834-12" aria-hidden="true" tabindex="-1"></a>club_pref_league[</span>
<span id="cb834-13"><a href="#cb834-13" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb834-14"><a href="#cb834-14" aria-hidden="true" tabindex="-1"></a>  league_pref_index <span class="sc">:</span><span class="er">=</span> league_weighted_rival <span class="sc">/</span> total_transfers</span>
<span id="cb834-15"><a href="#cb834-15" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(<span class="sc">-</span>league_pref_index)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country     buyer_clean total_transfers rival_transfers
     &lt;char&gt;          &lt;char&gt;           &lt;int&gt;           &lt;int&gt;
 1:   Italy           lecce               5               2
 2:   Spain      ca osasuna              16              12
 3:   Spain         levante              11               5
 4:   Spain          getafe              18               8
 5: Germany       1.fc köln              11               5
 6:   Italy          napoli              18               6
 7:   Italy      fiorentina              14               7
 8:   Spain   athletic club               6               2
 9:  France   stade rennais              24              11
10:   Italy   hellas verona              21               9
11: Germany       stuttgart              18               5
12: England          fulham              18               6
13: Germany      heidenheim               4               1
14:   Spain      real betis              24               7
15:   Italy            roma              34              10
16:   Italy          torino              22               4
17:  France         fc metz               7               3
18:   Italy        sassuolo              30               7
19:   Italy        atalanta              17               4
20: England   nott'm forest              20               4
21: England         man utd              17               4
22:   Spain  rayo vallecano              13               5
23: Germany        freiburg              15               6
24:   Spain        valencia              21               5
25:   Italy           lazio              22               7
26:   Spain        espanyol              12               4
27:   Spain    rcd mallorca              17               5
28:  France       fc nantes              11               2
29: Germany    union berlin              23               7
30: England       newcastle              15               5
31:   Italy         udinese              20               3
32:   Italy         bologna              17               3
33:   Spain      villarreal              26               7
34: England         burnley               8               3
35:  France      angers sco              19               8
36:   Italy           inter              23               6
37:   Italy        cagliari              10               1
38: England         arsenal              22               3
39: England  crystal palace              18               4
40: Germany        augsburg              24               5
41:   Spain        elche cf               6               1
42:  France   r. strasbourg              16               3
43:   Italy           genoa              19               2
44: Germany        dortmund              26               7
45:   Spain        atlético              22               4
46: England     aston villa              25               4
47:   Spain   celta de vigo              14               3
48:  France  stade brestois              19               5
49:   Italy        ac milan              20               3
50:   Italy        juventus              20               3
51: England        west ham              24               3
52: Germany         leipzig              21               3
53: Germany       wolfsburg              14               1
54: England       brentford               9               1
55:   Spain       barcelona              24               3
56:   Spain      sevilla fc              28               4
57:   Spain   real sociedad              15               2
58: England       tottenham              20               1
59: England         chelsea              31               5
60:   Spain          girona              12               3
61: England        Brighton              16               0
62: England          Wolves              21               0
63: England     bournemouth              10               1
64: England         everton              21               2
65: England       liverpool              14               0
66: England        man city              13               0
67: England           leeds              15               2
68:  France           Lille              18               0
69:  France            Lyon              24               0
70:  France       Marseille              21               0
71:  France          Monaco              26               0
72:  France            Nice              24               0
73:  France             PSG              31               0
74:  France        toulouse               6               1
75:  France            Lens              13               0
76:  France      fc lorient               8               3
77:  France      aj auxerre               6               0
78:  France     le havre ac               1               0
79: Germany       Frankfurt              22               0
80: Germany      Hoffenheim              12               0
81: Germany      Leverkusen              15               0
82: Germany           Mainz              17               0
83: Germany Mönchengladbach              13               0
84: Germany   bayern munich              21               2
85: Germany   werder bremen              13               1
86: Germany       st. pauli               2               0
87:   Italy           Parma              14               0
88:   Italy       cremonese               8               0
89:   Italy            como               9               1
90:   Spain          Alavés              16               0
91:   Spain     real madrid              15               0
    country     buyer_clean total_transfers rival_transfers
    league_weighted_rival avg_league_weight league_pref_index
                    &lt;num&gt;             &lt;num&gt;             &lt;num&gt;
 1:             3.2188758         1.2437752        0.64377516
 2:             8.6586928         0.7911683        0.54116830
 3:             5.5451774         1.0495616        0.50410704
 4:             8.8410143         1.0467230        0.49116746
 5:             4.7874917         0.9806811        0.43522652
 6:             7.8240460         1.1013359        0.43466922
 7:             4.9698133         0.8549867        0.35498666
 8:             2.0794415         1.0132403        0.34657359
 9:             7.5725030         0.8571876        0.31552096
10:             6.1092476         0.8623451        0.29091655
11:             5.0751738         1.0041763        0.28195410
12:             4.9698133         0.9427674        0.27610074
13:             1.0986123         1.0246531        0.27465307
14:             6.5792512         0.9824688        0.27413547
15:             9.1819409         0.9759394        0.27005709
16:             5.6629605         1.0755891        0.25740729
17:             1.7917595         0.8273942        0.25596564
18:             7.3369369         1.0112312        0.24456456
19:             3.9120230         0.9948249        0.23011900
20:             4.5643482         1.0282174        0.22821741
21:             3.8712010         0.9924236        0.22771771
22:             2.7725887         0.8286607        0.21327606
23:             3.1780538         0.8118703        0.21187026
24:             4.3820266         0.9705727        0.20866793
25:             4.5643482         0.8892886        0.20747037
26:             2.4849066         0.8737422        0.20707555
27:             3.4657359         0.9097492        0.20386682
28:             2.1972246         1.0179295        0.19974769
29:             4.2766661         0.8815942        0.18594201
30:             2.7725887         0.8515059        0.18483925
31:             3.6888795         1.0344440        0.18444397
32:             2.9957323         0.9997490        0.17621955
33:             4.5643482         0.9063211        0.17555185
34:             1.3862944         0.7982868        0.17328680
35:             3.1780538         0.7462134        0.16726599
36:             3.7376696         0.9016378        0.16250737
37:             1.3862944         1.0386294        0.13862944
38:             2.8903718         0.9950169        0.13138053
39:             2.1972246         0.8998458        0.12206803
40:             2.8903718         0.9120988        0.12043216
41:             0.6931472         0.9488579        0.11552453
42:             1.7917595         0.9244850        0.11198497
43:             2.0794415         1.0041811        0.10944429
44:             2.7725887         0.8374073        0.10663803
45:             2.1972246         0.9180557        0.09987384
46:             2.4849066         0.9393963        0.09939627
47:             1.3862944         0.8847353        0.09902103
48:             1.7917595         0.8311452        0.09430313
49:             1.7917595         0.9395880        0.08958797
50:             1.7917595         0.9395880        0.08958797
51:             2.0794415         0.9616434        0.08664340
52:             1.7917595         0.9424647        0.08532188
53:             1.0986123         1.0070437        0.07847231
54:             0.6931472         0.9659052        0.07701635
55:             1.7917595         0.9496566        0.07465664
56:             2.0794415         0.9314086        0.07426577
57:             1.0986123         0.9399075        0.07324082
58:             1.3862944         1.0193147        0.06931472
59:             1.7917595         0.8965084        0.05779869
60:             0.6931472         0.8077623        0.05776227
61:             0.0000000         1.0000000        0.00000000
62:             0.0000000         1.0000000        0.00000000
63:             0.0000000         0.9000000        0.00000000
64:             0.0000000         0.9047619        0.00000000
65:             0.0000000         1.0000000        0.00000000
66:             0.0000000         1.0000000        0.00000000
67:             0.0000000         0.8666667        0.00000000
68:             0.0000000         1.0000000        0.00000000
69:             0.0000000         1.0000000        0.00000000
70:             0.0000000         1.0000000        0.00000000
71:             0.0000000         1.0000000        0.00000000
72:             0.0000000         1.0000000        0.00000000
73:             0.0000000         1.0000000        0.00000000
74:             0.0000000         0.8333333        0.00000000
75:             0.0000000         1.0000000        0.00000000
76:             0.0000000         0.6250000        0.00000000
77:             0.0000000         1.0000000        0.00000000
78:             0.0000000         1.0000000        0.00000000
79:             0.0000000         1.0000000        0.00000000
80:             0.0000000         1.0000000        0.00000000
81:             0.0000000         1.0000000        0.00000000
82:             0.0000000         1.0000000        0.00000000
83:             0.0000000         1.0000000        0.00000000
84:             0.0000000         0.9047619        0.00000000
85:             0.0000000         0.9230769        0.00000000
86:             0.0000000         1.0000000        0.00000000
87:             0.0000000         1.0000000        0.00000000
88:             0.0000000         1.0000000        0.00000000
89:             0.0000000         0.8888889        0.00000000
90:             0.0000000         1.0000000        0.00000000
91:             0.0000000         1.0000000        0.00000000
    league_weighted_rival avg_league_weight league_pref_index</code></pre>
</div>
<div class="sourceCode cell-code" id="cb836"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb836-1"><a href="#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(club_pref_league[</span>
<span id="cb836-2"><a href="#cb836-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb836-3"><a href="#cb836-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">league_pref_index :=</span> league_weighted_rival <span class="sc">/</span> total_transfers</span>
<span id="cb836-4"><a href="#cb836-4" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(<span class="sc">-</span>league_pref_index)],</span>
<span id="cb836-5"><a href="#cb836-5" aria-hidden="true" tabindex="-1"></a><span class="st">"~/sem3/research_project/rival_analysis/data/weighted_rival_preference_league_level.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Global-level</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb837"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb837-1"><a href="#cb837-1" aria-hidden="true" tabindex="-1"></a>club_pref_global <span class="ot">&lt;-</span> xf_combined[</span>
<span id="cb837-2"><a href="#cb837-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb837-3"><a href="#cb837-3" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb837-4"><a href="#cb837-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_transfers =</span> .N,</span>
<span id="cb837-5"><a href="#cb837-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rival_transfers =</span> <span class="fu">sum</span>(is_rival),</span>
<span id="cb837-6"><a href="#cb837-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">global_weighted_rival =</span> <span class="fu">sum</span>(global_weight <span class="sc">*</span> is_rival),</span>
<span id="cb837-7"><a href="#cb837-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_global_weight =</span> <span class="fu">mean</span>(global_weight)</span>
<span id="cb837-8"><a href="#cb837-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb837-9"><a href="#cb837-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(country, buyer_clean)</span>
<span id="cb837-10"><a href="#cb837-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb837-11"><a href="#cb837-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-12"><a href="#cb837-12" aria-hidden="true" tabindex="-1"></a>club_pref_global[,</span>
<span id="cb837-13"><a href="#cb837-13" aria-hidden="true" tabindex="-1"></a>  global_pref_index <span class="sc">:</span><span class="er">=</span> global_weighted_rival <span class="sc">/</span> total_transfers</span>
<span id="cb837-14"><a href="#cb837-14" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(<span class="sc">-</span>global_pref_index)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country     buyer_clean total_transfers rival_transfers
     &lt;char&gt;          &lt;char&gt;           &lt;int&gt;           &lt;int&gt;
 1:   Spain      ca osasuna              16              12
 2: Germany       1.fc köln              11               5
 3:  France   stade rennais              24              11
 4:   Spain         levante              11               5
 5:   Italy      fiorentina              14               7
 6:   Italy           lecce               5               2
 7:   Spain          getafe              18               8
 8:   Spain  rayo vallecano              13               5
 9:  France         fc metz               7               3
10: England         burnley               8               3
11:   Italy   hellas verona              21               9
12: Germany        freiburg              15               6
13: England          fulham              18               6
14:   Italy          napoli              18               6
15:  France      angers sco              19               8
16:   Spain   athletic club               6               2
17: England       newcastle              15               5
18:  France      fc lorient               8               3
19:   Italy           lazio              22               7
20:   Spain        espanyol              12               4
21: Germany    union berlin              23               7
22: Germany      heidenheim               4               1
23:   Spain      villarreal              26               7
24: Germany        dortmund              26               7
25:   Spain      real betis              24               7
26: Germany       stuttgart              18               5
27:   Italy            roma              34              10
28:   Spain        valencia              21               5
29:   Spain    rcd mallorca              17               5
30: England         man utd              17               4
31: England  crystal palace              18               4
32:   Italy        sassuolo              30               7
33:  France  stade brestois              19               5
34: England   nott'm forest              20               4
35:   Italy           inter              23               6
36: Germany        augsburg              24               5
37:   Italy          torino              22               4
38:   Spain   celta de vigo              14               3
39:   Italy        atalanta              17               4
40:  France   r. strasbourg              16               3
41:  France       fc nantes              11               2
42:   Italy         bologna              17               3
43:  France        toulouse               6               1
44:   Spain        atlético              22               4
45: England     aston villa              25               4
46:   Spain          girona              12               3
47:   Italy        ac milan              20               3
48: England         chelsea              31               5
49:   Spain        elche cf               6               1
50: England         arsenal              22               3
51:   Italy         udinese              20               3
52: Germany         leipzig              21               3
53:   Spain      sevilla fc              28               4
54: England       brentford               9               1
55: England        west ham              24               3
56:   Italy        juventus              20               3
57:   Italy            como               9               1
58:   Spain   real sociedad              15               2
59:   Italy           genoa              19               2
60:   Italy        cagliari              10               1
61: England           leeds              15               2
62: England     bournemouth              10               1
63:   Spain       barcelona              24               3
64: Germany       wolfsburg              14               1
65: Germany   bayern munich              21               2
66: Germany   werder bremen              13               1
67: England         everton              21               2
68: England       tottenham              20               1
69: England        Brighton              16               0
70: England          Wolves              21               0
71: England       liverpool              14               0
72: England        man city              13               0
73:  France           Lille              18               0
74:  France            Lyon              24               0
75:  France       Marseille              21               0
76:  France          Monaco              26               0
77:  France            Nice              24               0
78:  France             PSG              31               0
79:  France            Lens              13               0
80:  France      aj auxerre               6               0
81:  France     le havre ac               1               0
82: Germany       Frankfurt              22               0
83: Germany      Hoffenheim              12               0
84: Germany      Leverkusen              15               0
85: Germany           Mainz              17               0
86: Germany Mönchengladbach              13               0
87: Germany       st. pauli               2               0
88:   Italy           Parma              14               0
89:   Italy       cremonese               8               0
90:   Spain          Alavés              16               0
91:   Spain     real madrid              15               0
    country     buyer_clean total_transfers rival_transfers
    global_weighted_rival avg_global_weight global_pref_index
                    &lt;num&gt;             &lt;num&gt;             &lt;num&gt;
 1:             36.395979          2.524749         2.2747487
 2:             17.276092          2.116008         1.5705538
 3:             34.345394          1.972725         1.4310581
 4:             15.417714          1.947065         1.4016104
 5:             19.081310          1.862951         1.3629507
 6:              6.734592          1.946918         1.3469183
 7:             23.839982          1.879999         1.3244434
 8:             14.750338          1.750026         1.1346414
 9:              7.806696          1.686671         1.1152423
10:              8.691146          1.711393         1.0863933
11:             22.454748          1.640702         1.0692737
12:             15.781358          1.652091         1.0520905
13:             18.889718          1.716095         1.0494288
14:             18.233320          1.679629         1.0129622
15:             18.560177          1.555799         0.9768514
16:              5.777652          1.629609         0.9629421
17:             14.269949          1.617997         0.9513299
18:              7.390181          1.548773         0.9237727
19:             20.217905          1.600814         0.9189957
20:             10.985208          1.582101         0.9154340
21:             20.856708          1.602466         0.9068134
22:              3.555348          1.638837         0.8888370
23:             22.032009          1.578154         0.8473850
24:             21.037859          1.539918         0.8091484
25:             19.270386          1.511266         0.8029328
26:             14.379756          1.521098         0.7988753
27:             25.423552          1.453634         0.7477515
28:             15.250849          1.488136         0.7262309
29:             12.146832          1.420402         0.7145195
30:             11.775790          1.457399         0.6926935
31:             12.231740          1.457319         0.6795411
32:             19.765915          1.425530         0.6588638
33:             12.335784          1.386094         0.6492518
34:             12.952464          1.447623         0.6476232
35:             14.722750          1.379250         0.6401196
36:             15.256793          1.427366         0.6356997
37:             13.016225          1.409828         0.5916466
38:              8.258681          1.375620         0.5899058
39:              9.980449          1.351791         0.5870852
40:              9.175749          1.385984         0.5734843
41:              6.186209          1.380564         0.5623826
42:              8.987697          1.352217         0.5286880
43:              3.044522          1.340754         0.5074204
44:             11.142152          1.324643         0.5064614
45:             11.941247          1.317650         0.4776499
46:              5.700444          1.225037         0.4750370
47:              9.230731          1.311537         0.4615366
48:             13.798161          1.283812         0.4451020
49:              2.639057          1.273176         0.4398429
50:              9.645817          1.302083         0.4384462
51:              8.497195          1.274860         0.4248597
52:              8.486940          1.261283         0.4041400
53:             11.166003          1.255929         0.3987858
54:              3.555348          1.283928         0.3950387
55:              9.226804          1.259450         0.3844502
56:              7.626570          1.231329         0.3813285
57:              3.218876          1.246542         0.3576529
58:              5.141664          1.209444         0.3427776
59:              6.257668          1.224088         0.3293509
60:              3.218876          1.221888         0.3218876
61:              4.477337          1.165156         0.2984891
62:              2.890372          1.189037         0.2890372
63:              6.396930          1.141539         0.2665387
64:              3.401197          1.171514         0.2429427
65:              5.036953          1.144617         0.2398549
66:              2.708050          1.131388         0.2083116
67:              4.276666          1.108413         0.2036508
68:              3.218876          1.110944         0.1609438
69:              0.000000          1.000000         0.0000000
70:              0.000000          1.000000         0.0000000
71:              0.000000          1.000000         0.0000000
72:              0.000000          1.000000         0.0000000
73:              0.000000          1.000000         0.0000000
74:              0.000000          1.000000         0.0000000
75:              0.000000          1.000000         0.0000000
76:              0.000000          1.000000         0.0000000
77:              0.000000          1.000000         0.0000000
78:              0.000000          1.000000         0.0000000
79:              0.000000          1.000000         0.0000000
80:              0.000000          1.000000         0.0000000
81:              0.000000          1.000000         0.0000000
82:              0.000000          1.000000         0.0000000
83:              0.000000          1.000000         0.0000000
84:              0.000000          1.000000         0.0000000
85:              0.000000          1.000000         0.0000000
86:              0.000000          1.000000         0.0000000
87:              0.000000          1.000000         0.0000000
88:              0.000000          1.000000         0.0000000
89:              0.000000          1.000000         0.0000000
90:              0.000000          1.000000         0.0000000
91:              0.000000          1.000000         0.0000000
    global_weighted_rival avg_global_weight global_pref_index</code></pre>
</div>
<div class="sourceCode cell-code" id="cb839"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb839-1"><a href="#cb839-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(club_pref_global[,</span>
<span id="cb839-2"><a href="#cb839-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">global_pref_index :=</span> global_weighted_rival <span class="sc">/</span> total_transfers</span>
<span id="cb839-3"><a href="#cb839-3" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(<span class="sc">-</span>global_pref_index)], <span class="st">"~/sem3/research_project/rival_analysis/data/weighted_rival_preference_global_level.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>